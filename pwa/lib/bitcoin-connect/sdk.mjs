/* esm.sh - esbuild bundle(@getalby/sdk@3.5.1) es2022 production */
import Y from"/v135/eventemitter3@5.0.1/es2022/eventemitter3.mjs";import{generatePrivateKey as J,relayInit as Q,nip19 as K,getPublicKey as Z,finishEvent as ee,getEventHash as te,nip04 as z}from"/v135/nostr-tools@1.17.0/es2022/nostr-tools.mjs";function o(){return o=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},o.apply(this,arguments)}function $(n,e){if(n==null)return{};var t,s,i={},r=Object.keys(n);for(s=0;s<r.length;s++)e.indexOf(t=r[s])>=0||(i[t]=n[t]);return i}function G(n){return Object.entries(n).map(([e,t])=>e&&t?`${e}=${t}`:"").filter(e=>e).join("&")}function B(n,e){return`Basic ${btoa(`${n}:${e}`)}`}var A=class extends Error{constructor(e,t,s,i){let r=e.toString();t&&(r+=` ${t}`),r+=": ",r+=i.message?i.message:JSON.stringify(i),super(r),this.status=void 0,this.statusText=void 0,this.headers=void 0,this.error=void 0,this.status=e,this.statusText=t,this.headers=s,this.error=i}},de={__proto__:null,OAuthClient:class{},AuthClient:class{},AlbyResponseError:A},ne=["auth","endpoint","params","request_body","method","max_retries","base_url","user_agent","headers"],se="https://api.getalby.com";async function D(n,e,t=0){let s=await fetch(n,e);if(s.status===429&&t>0){let i=Number(s.headers.get("x-rate-limit-reset")),r=Number(s.headers.get("x-rate-limit-remaining")),c=1e3*i-Date.now(),a=1e3;return r===0&&(a=c),await new Promise(l=>setTimeout(l,a)),D(n,e,t-1)}return s}async function ie(n){let{auth:e,endpoint:t,params:s={},request_body:i,method:r,max_retries:c,base_url:a=se,user_agent:l,headers:u}=n,y=$(n,ne),d=new URL(a+t);d.search=G(s);let w=r==="POST"&&!!i,m=e?await e.getAuthHeader(d.href,r):void 0,p=await D(d.toString(),o({headers:o({},w?{"Content-Type":"application/json; charset=utf-8"}:void 0,m,u,{"User-Agent":l??"@getalby/sdk","X-User-Agent":l??"@getalby/sdk"}),method:r,body:w?JSON.stringify(i):void 0},y),c);if(!p.ok){let v=await p.json();throw new A(p.status,p.statusText,p.headers,v)}return p}async function h(n){return(await ie(n)).json()}var re=["expires_in"],oe=["token"];function j(n){let{expires_in:e}=n;return o({},$(n,re),!!e&&{expires_at:Date.now()+1e3*e})}var R=class{constructor(e){this.bearer_token=void 0,this.bearer_token=e}getAuthHeader(){return{Authorization:`Bearer ${this.bearer_token}`}}},pe={__proto__:null,OAuth2User:class{constructor(n){this.token=void 0,this.options=void 0,this.code_verifier=void 0,this.code_challenge=void 0,this._refreshAccessTokenPromise=void 0,this._tokenEvents=void 0,this._tokenEvents=new Y;let{token:e}=n,t=$(n,oe);this.options=o({client_secret:""},t),this.token=e,this._refreshAccessTokenPromise=null}on(n,e){this._tokenEvents.on(n,e)}async refreshAccessToken(){var n=this;return this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=new Promise(async function(e,t){try{var s;let i=(s=n.token)==null?void 0:s.refresh_token,{client_id:r,client_secret:c,request_options:a,user_agent:l}=n.options;if(!r)throw new Error("client_id is required");if(!i)throw new Error("refresh_token is required");let u=j(await h(o({},a,{endpoint:"/oauth/token",params:{client_id:r,grant_type:"refresh_token",refresh_token:i},user_agent:l,method:"POST",headers:o({},a?.headers,{"Content-type":"application/x-www-form-urlencoded"},{Authorization:B(r,c)})})));n.token=u,e({token:u}),n._tokenEvents.emit("tokenRefreshed",n.token)}catch(i){console.error(i),t(i),n._tokenEvents.emit("tokenRefreshFailed",i)}finally{n._refreshAccessTokenPromise=null}})),this._refreshAccessTokenPromise}isAccessTokenExpired(){var n,e;let t=(n=this.token)==null?void 0:n.refresh_token,s=(e=this.token)==null?void 0:e.expires_at;return!s||!!t&&s<=Date.now()+1e3}async requestAccessToken(n){let{client_id:e,client_secret:t,callback:s,request_options:i,user_agent:r}=this.options,c=this.code_verifier;if(!e)throw new Error("client_id is required");if(!t&&!c)throw new Error("either client_secret is required, or code should be generated using a challenge");if(!s)throw new Error("callback is required");let a={code:n,grant_type:"authorization_code",code_verifier:c,client_id:e,redirect_uri:s},l=j(await h(o({},i,{endpoint:"/oauth/token",params:a,user_agent:r,method:"POST",headers:o({},i?.headers,{"Content-Type":"application/x-www-form-urlencoded"},{Authorization:B(e,t)})})));return this.token=l,{token:l}}async generateAuthURL(n){n||(n={});let{client_id:e,callback:t,scopes:s}=this.options;if(!t)throw new Error("callback required");if(!s)throw new Error("scopes required");let i;n.code_challenge_method==="S256"?(await this._generateS256Challenge(),i="S256"):n.code_challenge_method==="plain"&&n.code_challenge&&(this.code_challenge=n.code_challenge,this.code_verifier=n.code_challenge,i="plain");let r=this.code_challenge,c=new URL(n.authorizeUrl||"https://getalby.com/oauth");return c.search=G(o({},n,{client_id:e,scope:s.join(" "),response_type:"code",redirect_uri:t,code_challenge_method:i,code_challenge:r})),c.toString()}async getAuthHeader(){var n;if((n=this.token)==null||!n.access_token)throw new Error("access_token is required");return this.isAccessTokenExpired()&&await this.refreshAccessToken(),{Authorization:`Bearer ${this.token.access_token}`}}async _generateS256Challenge(){let n=crypto.getRandomValues(new Uint8Array(64));this.code_verifier=n.reduce((s,i)=>s+i.toString(16).padStart(2,"0"),"");let e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(this.code_verifier)),t=new Uint8Array(e);this.code_challenge=btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}},OAuth2Bearer:R},b=class extends Error{constructor(e,t){super(e),this.error=void 0,this.code=void 0,this.error=e,this.code=t}},x=class extends b{},k=class extends b{},E=class extends k{},P=class extends k{},T=class extends b{},N=class extends b{},_=class extends b{},S=class extends b{},V={alby:{authorizationUrl:"https://nwc.getalby.com/apps/new",relayUrl:"wss://relay.getalby.com/v1",walletPubkey:"69effe7b49a6dd5cf525bd0905917a5005ffe480b58eeb8e861418cf3ae760d9"}},U=class n{static parseWalletConnectUrl(e){e=e.replace("nostrwalletconnect://","http://").replace("nostr+walletconnect://","http://").replace("nostrwalletconnect:","http://").replace("nostr+walletconnect:","http://");let t=new URL(e),s=t.searchParams.get("relay");if(!s)throw new Error("No relay URL found in connection string");let i={walletPubkey:t.host,relayUrl:s},r=t.searchParams.get("secret");return r&&(i.secret=r),i}static withNewSecret(e){return(e=e||{}).secret=J(),new n(e)}constructor(e){var t;this.relay=void 0,this.relayUrl=void 0,this.secret=void 0,this.walletPubkey=void 0,this.options=void 0,e&&e.nostrWalletConnectUrl&&(e=o({},n.parseWalletConnectUrl(e.nostrWalletConnectUrl),e));let s=V[((t=e)==null?void 0:t.providerName)||"alby"];this.options=o({},s,e||{}),this.relayUrl=this.options.relayUrl,this.relay=Q(this.relayUrl),this.options.secret&&(this.secret=this.options.secret.toLowerCase().startsWith("nsec")?K.decode(this.options.secret).data:this.options.secret),this.walletPubkey=this.options.walletPubkey.toLowerCase().startsWith("npub")?K.decode(this.options.walletPubkey).data:this.options.walletPubkey,globalThis.WebSocket===void 0&&console.error("WebSocket is undefined. Make sure to `import websocket-polyfill` for nodejs environments")}get nostrWalletConnectUrl(){return this.getNostrWalletConnectUrl()}getNostrWalletConnectUrl(e=!0){let t=`nostr+walletconnect://${this.walletPubkey}?relay=${this.relayUrl}&pubkey=${this.publicKey}`;return e&&(t=`${t}&secret=${this.secret}`),t}get connected(){return this.relay.status===1}get publicKey(){if(!this.secret)throw new Error("Missing secret key");return Z(this.secret)}getPublicKey(){return Promise.resolve(this.publicKey)}signEvent(e){if(!this.secret)throw new Error("Missing secret key");return Promise.resolve(ee(e,this.secret))}getEventHash(e){return te(e)}close(){return this.relay.close()}async encrypt(e,t){if(!this.secret)throw new Error("Missing secret");return await z.encrypt(this.secret,e,t)}async decrypt(e,t){if(!this.secret)throw new Error("Missing secret");return await z.decrypt(this.secret,e,t)}getAuthorizationUrl(e){if(!this.options.authorizationUrl)throw new Error("Missing authorizationUrl option");let t=new URL(this.options.authorizationUrl);return e!=null&&e.name&&t.searchParams.set("name",e?.name),t.searchParams.set("pubkey",this.publicKey),e!=null&&e.returnTo&&t.searchParams.set("return_to",e.returnTo),e!=null&&e.budgetRenewal&&t.searchParams.set("budget_renewal",e.budgetRenewal),e!=null&&e.expiresAt&&t.searchParams.set("expires_at",Math.floor(e.expiresAt.getTime()/1e3).toString()),e!=null&&e.maxAmount&&t.searchParams.set("max_amount",e.maxAmount.toString()),e?.editable!==void 0&&t.searchParams.set("editable",e.editable.toString()),e!=null&&e.requestMethods&&t.searchParams.set("request_methods",e.requestMethods.join(" ")),t}initNWC(e={}){e.name||(e.name=document.location.host);let t=this.getAuthorizationUrl(e),s=window.outerHeight/2+window.screenY-300,i=window.outerWidth/2+window.screenX-200;return new Promise((r,c)=>{let a=window.open(t.toString(),`${document.title} - Wallet Connect`,`height=600,width=400,top=${s},left=${i}`);if(!a)return void c(new Error("failed to execute window.open"));let l=y=>{let d=y.data;d&&d.type==="nwc:success"&&y.origin===`${t.protocol}//${t.host}`&&(r(d),clearInterval(u),window.removeEventListener("message",l),a&&a.close())},u=setInterval(()=>{a&&a.closed&&(clearInterval(u),window.removeEventListener("message",l),c(new Error("Popup closed")))},500);window.addEventListener("message",l)})}async getWalletServiceSupportedMethods(){return console.warn("getWalletServiceSupportedMethods is deprecated. Please use getWalletServiceInfo instead."),(await this.getWalletServiceInfo()).capabilities}async getWalletServiceInfo(){var e;await this._checkConnected();let t=await this.relay.list([{kinds:[13194],limit:1,authors:[this.walletPubkey]}],{eoseSubTimeout:1e4});if(!t.length)throw new Error("no info event (kind 13194) returned from relay");let s=t[0].content,i=t[0].tags.find(r=>r[0]==="notifications");return{capabilities:s.split(/[ |,]/g),notifications:(i==null||(e=i[1])==null?void 0:e.split(" "))||[]}}async getInfo(){try{return await this.executeNip47Request("get_info",{},e=>!!e.methods)}catch(e){throw console.error("Failed to request get_info",e),e}}async getBalance(){try{return await this.executeNip47Request("get_balance",{},e=>e.balance!==void 0)}catch(e){throw console.error("Failed to request get_balance",e),e}}async payInvoice(e){try{return await this.executeNip47Request("pay_invoice",e,t=>!!t.preimage)}catch(t){throw console.error("Failed to request pay_invoice",t),t}}async payKeysend(e){try{return await this.executeNip47Request("pay_keysend",e,t=>!!t.preimage)}catch(t){throw console.error("Failed to request pay_keysend",t),t}}async signMessage(e){try{return await this.executeNip47Request("sign_message",e,t=>t.message===e.message&&!!t.signature)}catch(t){throw console.error("Failed to request sign_message",t),t}}async multiPayInvoice(e){try{return{invoices:await this.executeMultiNip47Request("multi_pay_invoice",e,e.invoices.length,t=>!!t.preimage),errors:[]}}catch(t){throw console.error("Failed to request multi_pay_invoice",t),t}}async multiPayKeysend(e){try{return{keysends:await this.executeMultiNip47Request("multi_pay_keysend",e,e.keysends.length,t=>!!t.preimage),errors:[]}}catch(t){throw console.error("Failed to request multi_pay_keysend",t),t}}async makeInvoice(e){try{if(!e.amount)throw new Error("No amount specified");return await this.executeNip47Request("make_invoice",e,t=>!!t.invoice)}catch(t){throw console.error("Failed to request make_invoice",t),t}}async lookupInvoice(e){try{return await this.executeNip47Request("lookup_invoice",e,t=>!!t.invoice)}catch(t){throw console.error("Failed to request lookup_invoice",t),t}}async listTransactions(e){try{return await this.executeNip47Request("list_transactions",e,t=>!!t.transactions)}catch(t){throw console.error("Failed to request list_transactions",t),t}}async subscribeNotifications(e){var t=this;let s,i,r,c=!0;return async function(){for(;c;){try{await t._checkConnected(),r=t.relay.sub([{kinds:[23196],authors:[t.walletPubkey],"#p":[t.publicKey]}]),console.info("subscribed to relay"),r.on("event",async function(a){let l=await t.decrypt(t.walletPubkey,a.content),u;try{u=JSON.parse(l)}catch(y){return void console.error("Failed to parse decrypted event content",y)}u.notification?e(u):console.error("No notification in response",u)}),await new Promise(a=>{s=()=>{a()},i=()=>{console.info("relay disconnected"),s?.()},t.relay.on("disconnect",i)}),i!==void 0&&t.relay.off("disconnect",i)}catch(a){console.error("error subscribing to notifications",a||"unknown relay error")}c&&await new Promise(a=>setTimeout(a,1e3))}}(),()=>{var a;c=!1,s?.(),(a=r)==null||a.unsub()}}async executeNip47Request(e,t,s){var i=this;return await this._checkConnected(),new Promise((r,c)=>{(async function(){let a={method:e,params:t},l=await i.encrypt(i.walletPubkey,JSON.stringify(a)),u={kind:23194,created_at:Math.floor(Date.now()/1e3),tags:[["p",i.walletPubkey]],content:l,pubkey:i.publicKey},y=await i.signEvent(u),d=i.relay.sub([{kinds:[23195],authors:[i.walletPubkey],"#e":[y.id]}]),w=setTimeout(function(){d.unsub(),c(new P(`reply timeout: event ${y.id}`,"INTERNAL"))},6e4);d.on("event",async function(p){clearTimeout(w),d.unsub();let v=await i.decrypt(i.walletPubkey,p.content),g;try{g=JSON.parse(v)}catch{return clearTimeout(w),d.unsub(),void c(new N("failed to deserialize response","INTERNAL"))}var q,f;g.result?s(g.result)?r(g.result):(clearTimeout(w),d.unsub(),c(new _("response from NWC failed validation: "+JSON.stringify(g.result),"INTERNAL"))):(clearTimeout(w),d.unsub(),c(new x(((q=g.error)==null?void 0:q.message)||"unknown Error",((f=g.error)==null?void 0:f.code)||"INTERNAL")))});let m=setTimeout(function(){d.unsub(),c(new E(`publish timeout: ${y.id}`,"INTERNAL"))},5e3);try{await i.relay.publish(y),clearTimeout(m)}catch(p){clearTimeout(m),c(new T(`failed to publish: ${p}`,"INTERNAL"))}})()})}async executeMultiNip47Request(e,t,s,i){var r=this;await this._checkConnected();let c=[];return new Promise((a,l)=>{(async function(){let u={method:e,params:t},y=await r.encrypt(r.walletPubkey,JSON.stringify(u)),d={kind:23194,created_at:Math.floor(Date.now()/1e3),tags:[["p",r.walletPubkey]],content:y,pubkey:r.publicKey},w=await r.signEvent(d),m=r.relay.sub([{kinds:[23195],authors:[r.walletPubkey],"#e":[w.id]}]),p=setTimeout(function(){m.unsub(),l(new P(`reply timeout: event ${w.id}`,"INTERNAL"))},6e4);m.on("event",async function(g){let q=await r.decrypt(r.walletPubkey,g.content),f;try{f=JSON.parse(q)}catch{clearTimeout(p),m.unsub(),l(new N("failed to deserialize response","INTERNAL"))}if(f.result){var C;if(!i(f.result))return clearTimeout(p),m.unsub(),void l(new _("Response from NWC failed validation: "+JSON.stringify(f.result),"INTERNAL"));let W=(C=g.tags.find(X=>X[0]==="d"))==null?void 0:C[1];if(W===void 0)return clearTimeout(p),m.unsub(),void l(new _("No d tag found in response event","INTERNAL"));c.push(o({},f.result,{dTag:W})),c.length===s&&(clearTimeout(p),m.unsub(),a(c))}else{var M,L;clearTimeout(p),m.unsub(),l(new S((M=f.error)==null?void 0:M.message,(L=f.error)==null?void 0:L.code))}});let v=setTimeout(function(){m.unsub(),l(new E(`Publish timeout: ${w.id}`,"INTERNAL"))},5e3);try{await r.relay.publish(w),clearTimeout(v)}catch(g){clearTimeout(v),l(new T(`Failed to publish: ${g}`,"INTERNAL"))}})()})}async _checkConnected(){if(!this.secret)throw new Error("Missing secret key");await this.relay.connect()}},ye={__proto__:null,Nip47Error:b,Nip47WalletError:x,Nip47TimeoutError:k,Nip47PublishTimeoutError:E,Nip47ReplyTimeoutError:P,Nip47PublishError:T,Nip47ResponseDecodingError:N,Nip47ResponseValidationError:_,Nip47UnexpectedResponseError:S,NWCs:V,NWCClient:U},ae={get_info:"getInfo",get_balance:"getBalance",make_invoice:"makeInvoice",pay_invoice:"sendPayment",pay_keysend:"payKeysend",lookup_invoice:"lookupInvoice",list_transactions:"listTransactions",multi_pay_invoice:"sendMultiPayment",multi_pay_keysend:"multiKeysend",sign_message:"signMessage"},I=class n{get relay(){return console.warn("relay is deprecated. Please use client.relay instead."),this.client.relay}get relayUrl(){return console.warn("relayUrl is deprecated. Please use client.relayUrl instead."),this.client.relayUrl}get walletPubkey(){return console.warn("walletPubkey is deprecated. Please use client.walletPubkey instead."),this.client.walletPubkey}get options(){return this.client.options}get secret(){return console.warn("secret is deprecated. Please use client.secret instead."),this.client.secret}static withNewSecret(e){return(e=e||{}).secret=J(),new n(e)}constructor(e){this._enabled=!1,this.client=void 0,this.subscribers=void 0,this.client=new U(e),this.subscribers={}}on(e,t){this.subscribers[e]=t}notify(e,t){let s=this.subscribers[e];s&&s(t)}getNostrWalletConnectUrl(e=!0){return console.warn("getNostrWalletConnectUrl is deprecated. Please use client.getNostrWalletConnectUrl instead."),this.client.getNostrWalletConnectUrl(e)}get nostrWalletConnectUrl(){return console.warn("nostrWalletConnectUrl is deprecated. Please use client.nostrWalletConnectUrl instead."),this.client.nostrWalletConnectUrl}get connected(){return console.warn("connected is deprecated. Please use client.connected instead."),this.client.connected}get publicKey(){return console.warn("publicKey is deprecated. Please use client.publicKey instead."),this.client.publicKey}getPublicKey(){return this.client.getPublicKey()}signEvent(e){return this.client.signEvent(e)}getEventHash(e){return console.warn("getEventHash is deprecated. Please use client.getEventHash instead."),this.client.getEventHash(e)}async enable(){this._enabled=!0}close(){return this.client.close()}async encrypt(e,t){return console.warn("encrypt is deprecated. Please use client.encrypt instead."),this.client.encrypt(e,t)}async decrypt(e,t){return console.warn("decrypt is deprecated. Please use client.decrypt instead."),this.client.decrypt(e,t)}getAuthorizationUrl(e){return console.warn("getAuthorizationUrl is deprecated. Please use client.getAuthorizationUrl instead."),this.client.getAuthorizationUrl(e)}initNWC(e={}){return console.warn("initNWC is deprecated. Please use client.initNWC instead."),this.client.initNWC(e)}async getInfo(){await this.checkEnabled();let e=["lightning","nostr"],t="Alby JS SDK";try{let s=await this.client.getInfo(),i={methods:s.methods.map(r=>ae[r]),node:{alias:s.alias,pubkey:s.pubkey,color:s.color},supports:e,version:t};return this.notify("getInfo",i),i}catch(s){return console.error("Using minimal getInfo",s),{methods:["sendPayment"],node:{},supports:e,version:t}}}async getBalance(){await this.checkEnabled();let e=await this.client.getBalance(),t={balance:Math.floor(e.balance/1e3),currency:"sats"};return this.notify("getBalance",t),t}async sendPayment(e){await this.checkEnabled();let t={preimage:(await this.client.payInvoice({invoice:e})).preimage};return this.notify("sendPayment",t),t}async sendPaymentAsync(e){return await this.checkEnabled(),this.client.payInvoice({invoice:e}),this.notify("sendPaymentAsync",{}),{}}async keysend(e){await this.checkEnabled();let t={preimage:(await this.client.payKeysend(F(e))).preimage};return this.notify("keysend",t),t}async signMessage(e){await this.checkEnabled();let t=await this.client.signMessage({message:e}),s={message:t.message,signature:t.signature};return this.notify("keysend",s),s}async makeInvoice(e){var t;await this.checkEnabled();let s=typeof e=="object"?e:void 0,i=+((t=s?.amount)!=null?t:e);if(!i)throw new Error("No amount specified");let r={paymentRequest:(await this.client.makeInvoice({amount:1e3*i,description:s?.defaultMemo})).invoice};return this.notify("makeInvoice",r),r}async lookupInvoice(e){await this.checkEnabled();let t=await this.client.lookupInvoice({invoice:e.paymentRequest,payment_hash:e.paymentHash}),s={preimage:t.preimage,paymentRequest:t.invoice,paid:!!t.settled_at};return this.notify("lookupInvoice",s),s}async listTransactions(e){await this.checkEnabled();let t={transactions:(await this.client.listTransactions(e)).transactions.map(ce)};return this.notify("listTransactions",t),t}async sendMultiPayment(e){await this.checkEnabled();let t=await this.client.multiPayInvoice({invoices:e.map((i,r)=>({invoice:i,id:r.toString()}))}),s={payments:t.invoices.map(i=>{let r=e[parseInt(i.dTag)];if(!r)throw new Error("Could not find paymentRequest matching response d tag");return{paymentRequest:r,preimage:i.preimage}}),errors:[]};return this.notify("sendMultiPayment",s),s}async multiKeysend(e){await this.checkEnabled();let t=await this.client.multiPayKeysend({keysends:e.map((i,r)=>o({},F(i),{id:r.toString()}))}),s={keysends:t.keysends.map(i=>{let r=e[parseInt(i.dTag)];if(!r)throw new Error("Could not find keysend matching response d tag");return{keysend:r,preimage:i.preimage}}),errors:[]};return this.notify("multiKeysend",s),s}lnurl(e){throw new Error("Method not implemented.")}request(e,t){throw new Error("Method not implemented.")}verifyMessage(e,t){throw new Error("Method not implemented.")}async checkEnabled(){if(!this._enabled)throw new Error("please call enable() and await the promise before calling this function")}};function ce(n){return o({},n,{amount:Math.floor(n.amount/1e3),fees_paid:n.fees_paid?Math.floor(n.fees_paid/1e3):0})}function F(n){return{amount:1e3*+n.amount,pubkey:n.destination,tlv_records:n.customRecords?Object.entries(n.customRecords).map(e=>({type:parseInt(e[0]),value:e[1]})):[]}}var le=I;function H(n){let e={};return n.recipient.customKey&&n.recipient.customValue&&(e[n.recipient.customKey]=n.recipient.customValue),e[7629169]=JSON.stringify(n.boostagram),{destination:n.recipient.address,amount:n.amount,custom_records:e}}var O=class{constructor(e,t){this.auth=void 0,this.defaultRequestOptions=void 0,this.auth=typeof e=="string"?new R(e):e,this.defaultRequestOptions=o({},t,{user_agent:t?.user_agent})}accountBalance(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/balance",params:e,method:"GET"}))}accountSummary(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/user/summary",params:e,method:"GET"}))}accountInformation(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/user/me",params:e,method:"GET"}))}accountValue4Value(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/user/value4value",params:e,method:"GET"}))}incomingInvoices(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices/incoming",params:e,method:"GET"}))}outgoingInvoices(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices/outgoing",params:e,method:"GET"}))}invoices(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices",params:e,method:"GET"}))}getInvoice(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:`/invoices/${e}`,method:"GET"}))}decodeInvoice(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:`/decode/bolt11/${e}`,method:"GET"}))}createInvoice(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices",request_body:e,method:"POST"}))}keysend(e,t){let s,i;return Array.isArray(e)?(s="/payments/keysend/multi",i={keysends:e.map(r=>o({},r,{custom_records:r.customRecords}))}):(s="/payments/keysend",i=o({},e,{custom_records:e.customRecords})),h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:s,request_body:i,method:"POST"}))}sendPayment(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/payments/bolt11",request_body:e,method:"POST"}))}sendBoostagram(e,t){let s,i;return Array.isArray(e)?(s="/payments/keysend/multi",i={keysends:e.map(r=>H(r))}):(s="/payments/keysend",i=H(e)),h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:s,request_body:i,method:"POST"}))}sendToAlbyAccount(e,t){return console.warn("sendToAlbyAccount is deprecated. Please use sendBoostagramToAlbyAccount instead."),this.sendBoostagramToAlbyAccount(e,t)}sendBoostagramToAlbyAccount(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/payments/keysend",request_body:{destination:"030a58b8653d32b99200a2334cfe913e51dc7d155aa0116c176657a4f1722677a3",custom_records:{696969:e.account},amount:e.amount,memo:e.memo},method:"POST"}))}createWebhookEndpoint(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/webhook_endpoints",request_body:e,method:"POST"}))}deleteWebhookEndpoint(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:`/webhook_endpoints/${e}`,method:"DELETE"}))}getSwapInfo(e){return h(o({auth:this.auth},this.defaultRequestOptions,e,{endpoint:"/swaps/info",method:"GET"}))}createSwap(e,t){return h(o({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/swaps",method:"POST",request_body:e}))}},me={__proto__:null,NostrWebLNProvider:I,NWC:le,OauthWeblnProvider:class{constructor(n){this.client=void 0,this.auth=void 0,this.oauth=void 0,this.subscribers=void 0,this.isExecuting=void 0,this.auth=n.auth,this.client=new O(n.auth),this.oauth=!0,this.subscribers={},this.isExecuting=!1}on(n,e){this.subscribers[n]=e}notify(n,e){let t=this.subscribers[n];t&&t(e)}async enable(){var n;if(!this.isExecuting){if((n=this.auth.token)!=null&&n.access_token)return{enabled:!0};if(typeof window>"u"||window.document===void 0)throw new Error("Missing access token");try{this.isExecuting=!0,await this.openAuthorization()}finally{this.isExecuting=!1}}}async sendPayment(n){if(!this.isExecuting)try{this.isExecuting=!0;let e=await this.client.sendPayment({invoice:n});return this.notify("sendPayment",e),{preimage:e.payment_preimage}}catch(e){let t="Unknown Error";throw e instanceof Error&&(t=e.message),new Error(t)}finally{this.isExecuting=!1}}async keysend(n){if(!this.isExecuting)try{this.isExecuting=!0;let e=await this.client.keysend(n);return this.notify("keysend",e),{preimage:e.payment_preimage}}catch(e){let t="Unknown Error";throw e instanceof Error&&(t=e.message),new Error(t)}finally{this.isExecuting=!1}}async getInfo(){return{alias:"Alby"}}async makeInvoice(n){if(!this.isExecuting)try{this.isExecuting=!0;let e=await this.client.createInvoice({amount:parseInt(n.amount.toString()),description:n.defaultMemo});return this.notify("makeInvoice",e),{paymentRequest:e.payment_request}}catch(e){let t="Unknown Error";throw e instanceof Error&&(t=e.message),new Error(t)}finally{this.isExecuting=!1}}async openAuthorization(){var n=this;let e=window.outerHeight/2+window.screenY-350,t=window.outerWidth/2+window.screenX-300,s=await this.auth.generateAuthURL({code_challenge_method:"S256"});return new Promise((i,r)=>{let c=window.open(s,`${document.title} - WebLN enable`,`height=700,width=600,top=${e},left=${t}`),a=!1;window.addEventListener("message",async function(l){let u=l.data;if(u&&u.type==="alby:oauth:success"&&l.origin===`${document.location.protocol}//${document.location.host}`&&!a){a=!0,console.info("Processing OAuth code response");let y=u.payload.code;try{await n.auth.requestAccessToken(y),n.client=new O(n.auth),c&&c.close(),n.notify("enable"),i({enabled:!0})}catch(d){console.error(d),r({enabled:!1})}}})})}}};export{O as Client,pe as auth,ye as nwc,de as types,me as webln};
//# sourceMappingURL=sdk.mjs.map