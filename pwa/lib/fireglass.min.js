/*
 * FireGlass UI Framework tbd 
 * Copyright (C) 2023-2024 by Contributors
 * 
 * Satoshi Fairware License
 * 
 * This license requires paying one's fair share to the project contributors in
 * exchange for GPL-like rights. See https://satoshidnc.com/licenses for the
 * full license text and to calculate and pay your fair share.
 * 
 * This text pointing to the license must accompany the software.
 */
var vp=function(){function M(){return 0<navigator.maxTouchPoints?85:5}function ca(){if(S){var a=S,c;a.actionFlags&vp.GAF_NUMINPUT&&(c=Z);a.actionFlags&vp.GAF_TEXTINPUT&&(c=aa);c&&(c.blur(),c.style.display="none");S=void 0}}function da(a){ca();S=a;a.textBeginFunc&&a.textBeginFunc.call(a);a.actionFlags&vp.GAF_GONEXT&&(ea.style.display="inline",fa.style.display="inline");let c;a.actionFlags&vp.GAF_NUMINPUT&&(c=Z);a.actionFlags&vp.GAF_TEXTINPUT&&(c=aa);c&&(c.value=a.text,c.style.display="inline",c.focus(),
c.select())}function ua(a){if(a!=ba){var c=0;0<ba&&(c=a-ba);ba=a;const b=[];for(;a=A.pop();)b.push(a);if(ha)ha=!1,k.viewport(0,0,w.width,w.height),mat4.identity(N),mat4.translate(N,N,[-1,1,0]),mat4.scale(N,N,[2/w.width,-2/w.height,1]),v&&(a=new vp.LayoutState(w.width,w.height),v.layoutAll(a));else for(;a=b.pop();)a.relayout();ia&&(--ia||v.setRenderFlag(!0));ja&&v.setRenderFlag(!0);if(v&&(v.needsRender||v.childRender)){a=0;for(var [,d]of Object.entries(t))d.dx=(d.x-d.px)/c,d.px=d.x,d.dy=(d.y-d.py)/
c,d.py=d.y,a+=Math.sqrt(d.dx*d.dx+d.dy*d.dy)/va;ka&&ka.setValueAtTime(a,F.currentTime);v.renderAll();if(wa){k.viewport(0,0,w.width,w.height);k.disable(k.SCISSOR_TEST);k.useProgram(B);k.bindBuffer(k.ARRAY_BUFFER,la);c=k.getAttribLocation(B,"aVertexPosition");k.vertexAttribPointer(c,2,k.FLOAT,!1,0,0);k.enableVertexAttribArray(c);k.enable(k.BLEND);k.uniform4fv(k.getUniformLocation(B,"uVertexColor"),new Float32Array([1,1,1,1]));k.uniformMatrix4fv(k.getUniformLocation(B,"uProjectionMatrix"),!1,N);c=mat4.create();
if(ja){d=[];for(var [,f]of Object.entries(t))if(f.hitList){a=f.hitList.getActionableGads(vp.GAF_ALL);for(const g of a)d.includes(g)||d.push(g)}for(const g of d)if(g.ownedBy){f=g.convexHull;for(p=0;p<f.length;p+=2)mat4.fromTranslation(c,[g.viewport.x,g.viewport.y,0]),mat4.mul(c,c,g.viewport.userMat),mat4.scale(c,c,[g.viewport.getScale(),g.viewport.getScale(),1]),mat4.translate(c,c,[g.x+f[p+0]-g.viewport.userX,g.y+f[p+1]-g.viewport.userY,0]),mat4.scale(c,c,[f[(p+2)%f.length]-f[p+0],f[(p+3)%f.length]-
f[p+1],1]),k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c),k.drawArrays(k.LINE_LOOP,y.unitLine,E.unitLine);f=vec3.create();mat4.getScaling(f,g.viewport.userMat)}for(const [,g]of Object.entries(t))mat4.identity(c),mat4.translate(c,c,[g.x,g.y,0]),k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c),"mouse"==g.e.pointerType?k.drawArrays(k.LINE_LOOP,y.roundMouse,E.roundMouse):k.drawArrays(k.LINE_LOOP,y.roundTouch,E.roundTouch)}ma=(ma+1)%16;mat4.identity(c);mat4.translate(c,
c,[160,45,0]);mat4.rotate(c,c,Math.PI/8*ma,[0,0,1]);mat4.scale(c,c,[40,10,0]);k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,10,0]);mat4.scale(c,c,[50,10,0]);k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,25,0]);mat4.scale(c,c,[50*window.visualViewport.scale,10,0]);k.uniformMatrix4fv(k.getUniformLocation(B,
"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,40,0]);mat4.scale(c,c,[50*window.devicePixelRatio,10,0]);k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,55,0]);mat4.scale(c,c,[50*window.innerWidth/1E3,10,0]);k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);
for(const [,g]of Object.entries(t))mat4.identity(c),mat4.translate(c,c,[12,57,0]),mat4.scale(c,c,[46*g.x/C/1E3,6,0]),k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c),k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,70,0]);mat4.scale(c,c,[50*window.innerHeight/1E3,10,0]);k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare);for(const [,g]of Object.entries(t))mat4.identity(c),
mat4.translate(c,c,[12,72,0]),mat4.scale(c,c,[46*g.y/C/1E3,6,0]),k.uniformMatrix4fv(k.getUniformLocation(B,"uModelViewMatrix"),!1,c),k.drawArrays(k.LINE_LOOP,y.unitSquare,E.unitSquare)}}}window.requestAnimationFrame(ua)}function U(){ia=10;var a=window.innerWidth,c=window.innerHeight;w.width=a*window.visualViewport.scale*window.devicePixelRatio;w.height=c*window.visualViewport.scale*window.devicePixelRatio;w.style.width=a*window.visualViewport.scale;w.style.height=c*window.visualViewport.scale;va=
Math.sqrt(w.width*w.width+w.height*w.height);C=window.visualViewport.scale*window.devicePixelRatio;ha=!0;v.resizeFunc&&v.resizeFunc.call(v)}function J(a,c){function d(m,n){for(const q of m.hitList.hits)q.gad!==n&&q.gad.ownedBy==g&&(q.gad.gestureState+="-disowned",q.gad.viewport.setRenderFlag(!0),delete q.gad.ownedBy)}function f(m){const n=m.x-m.ox;m=m.y-m.oy;return n*n>m*m?0<n?"right":"left":0<m?"down":"up"}if("touches"==c&&a.touches&&0==a.touches.length){a=[];for(var [,b]of Object.entries(t))b.tempIsActive=
"mouse"==b.e.pointerType;for(const [m,n]of Object.entries(t))n.tempIsActive||a.push(m);for(;a.length;)delete t[a.pop()];for(const [,m]of Object.entries(t))delete m.tempIsActive}else{C!=window.visualViewport.scale*window.devicePixelRatio&&U();var g="p-"+a.pointerId;switch(c){case "down":ca();t.hasOwnProperty(g)||(t[g]={gestureState:"",touching:!1,px:a.layerX*C,py:a.layerY*C});b=t[g];b.e=a;b.touching=!0;b.x=a.layerX*C;b.y=a.layerY*C;b.ox=b.x;b.oy=b.y;b.hitList=new vp.HitList(b.x,b.y);v.getHits(b.hitList,
M());b.hitList.sortHits();if("mouse"==a.pointerType){if(0==a.button)for(const m of b.hitList.hits){var e=m.gad;!e.ownedBy&&e.actionFlags&vp.GAF_CLICKABLE&&(e.gestureState="begin-click",e.ownedBy=g,e.viewport.setRenderFlag(!0));!e.ownedBy&&e.actionFlags&vp.GAF_DRAGGABLE&&(e.gestureState="begin-drag",e.ownedBy=g,e.viewport.setRenderFlag(!0));!e.ownedBy&&e.actionFlags&(vp.GAF_NUMINPUT|vp.GAF_TEXTINPUT)&&(e.gestureState="begin-input",e.ownedBy=g,e.viewport.setRenderFlag(!0));e.gestureTimerId=setTimeout(J,
250,a,"drag time reached")}if(2==a.button)for(const m of b.hitList.hits)b=m.gad,!b.ownedBy&&b.actionFlags&vp.GAF_CONTEXTMENU&&(b.gestureState="begin-menu",b.ownedBy=g,b.viewport.setRenderFlag(!0),V())}else{e=!1;for(const m of b.hitList.hits)(b=m.gad,b.ownedBy)?b.ownedBy!=g&&("await-pinch"==b.gestureState||b.actionFlags&vp.GAF_PINCHABLE&&("begin-drag"==b.gestureState||"begin-tap"==b.gestureState)?(b.gestureState="pinch",b.secondTouch=g,b.viewport.setRenderFlag(!0),b.pinchBeginFunc&&b.pinchBeginFunc.call(b,
t[b.ownedBy],t[b.secondTouch])):"drag"==b.gestureState&&b.actionFlags&vp.GAF_PINCHABLE&&(b.gestureState="pinch",b.secondTouch=g,b.viewport.setRenderFlag(!0),b.dragEndFunc&&b.dragEndFunc.call(b,t[b.ownedBy]),b.pinchBeginFunc&&b.pinchBeginFunc.call(b,t[b.ownedBy],t[b.secondTouch]))):b.actionFlags&vp.GAF_CLICKABLE&&!e?(b.gestureState="begin-tap",b.ownedBy=g,e=!0,b.viewport.setRenderFlag(!0),b.gestureBeginTime=a.timeStamp,b.actionFlags&(vp.GAF_CONTEXTMENU|vp.GAF_HOLDABLE|vp.GAF_DRAGGABLE)&&(b.gestureTimerId=
setTimeout(J,250,a,"tap-and-hold time reached"))):b.actionFlags&(vp.GAF_NUMINPUT|vp.GAF_TEXTINPUT)?(b.gestureState="begin-input",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureBeginTime=a.timeStamp,b.actionFlags&vp.GAF_CONTEXTMENU&&(b.gestureTimerId=setTimeout(J,250,a,"tap-and-hold time reached"))):b.actionFlags&vp.GAF_CONTEXTMENU?(b.gestureState="begin-menu",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureTimerId=setTimeout(J,250,a,"tap-and-hold time reached")):b.actionFlags&vp.GAF_HOLDABLE?
(b.gestureState="begin-hold",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureTimerId=setTimeout(J,250,a,"tap-and-hold time reached")):b.actionFlags&vp.GAF_DRAGGABLE?(b.gestureState="begin-drag",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureTimerId=setTimeout(J,250,a,"drag time reached")):b.actionFlags&vp.GAF_SWIPEABLE?(b.gestureState="begin-swipe",b.ownedBy=g,b.viewport.setRenderFlag(!0)):b.actionFlags&vp.GAF_PINCHABLE&&(b.gestureState="await-pinch",b.ownedBy=g,b.viewport.setRenderFlag(!0))}break;
case "move":na||"mouse"!=a.pointerType||(na=1,v.enableMouse&&v.enableMouse.call(v));t.hasOwnProperty(g)||(t[g]={gestureState:"mouse"==a.pointerType?"hover":"",touching:"mouse"==a.pointerType?!1:!0});b=t[g];b.e=a;b.px=b.x;b.x=a.layerX*C;b.py=b.y;b.y=a.layerY*C;if("mouse"==a.pointerType){if(b.hitList)for(e of b.hitList.hits){var h=e.gad;if(h.ownedBy==g)switch(h.gestureState){case "begin-click":case "recover-click":a=new vp.HitList(b.x,b.y);h.getHits(a,M());0==a.hits.length&&(h.gestureState="abandon-click",
h.viewport.setRenderFlag(!0));break;case "begin-input":a=new vp.HitList(b.x,b.y);h.getHits(a,M());0==a.hits.length&&(h.gestureState="abandon-input",h.viewport.setRenderFlag(!0));break;case "hold":a=new vp.HitList(b.x,b.y);h.getHits(a,M());0==a.hits.length&&(h.gestureState="abandon-hold",h.viewport.setRenderFlag(!0),h.holdEndFunc&&h.holdEndFunc.call(h,b));break;case "abandon-click":a=new vp.HitList(b.x,b.y);h.getHits(a,M());0!=a.hits.length&&(h.gestureState="recover-click",h.viewport.setRenderFlag(!0));
break;case "abandon-hold":a=new vp.HitList(b.x,b.y);h.getHits(a,M());0!=a.hits.length&&(h.gestureState="hold",h.viewport.setRenderFlag(!0),h.holdBeginFunc&&h.holdBeginFunc.call(h,b));break;case "begin-drag":a=f(b);Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>P&&(h.hasOwnProperty("gestureTimerId")&&(clearTimeout(h.gestureTimerId),delete h.gestureTimerId),("up"==a||"down"==a)&&h.actionFlags&vp.GAF_DRAGGABLE_UPDOWN||("left"==a||"right"==a)&&h.actionFlags&vp.GAF_DRAGGABLE_LEFTRIGHT)&&(h.gestureState="drag",
h.viewport.setRenderFlag(!0),d(b,h),h.dragBeginFunc&&h.dragBeginFunc.call(h,b),h.dragMoveFunc&&h.dragMoveFunc.call(h,b));break;case "drag":h.dragMoveFunc&&h.dragMoveFunc.call(h,b)}}}else for(h of b.hitList.hits)if(e=h.gad,e.ownedBy==g)switch(e.gestureState){case "begin-tap":if(Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>P&&(e.gestureState="invalid-tap",e.viewport.setRenderFlag(!0),!b.swiping))if(a=f(b),("up"==a||"down"==a)&&e.actionFlags&vp.GAF_SWIPEABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&
vp.GAF_SWIPEABLE_LEFTRIGHT){e.gestureState="swipe";b.swiping=!0;e.viewport.setRenderFlag(!0);for(var l of b.hitList.hits)l.gad!==e&&l.gad.ownedBy==g&&delete l.gad.ownedBy;delete b.cancel;e.swipeBeginFunc&&e.swipeBeginFunc.call(e,b);b.cancel?e.gestureState="prog-cancel-swipe":(e.swipeMoveFunc&&e.swipeMoveFunc.call(e,b),console.log("swipe "+a))}else if(("up"==a||"down"==a)&&e.actionFlags&vp.GAF_DRAGGABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&vp.GAF_DRAGGABLE_LEFTRIGHT)e.gestureState="drag",
b.swiping=!0,e.viewport.setRenderFlag(!0),DisownAllOtherGags(b,e),delete b.cancel,e.dragBeginFunc&&e.dragBeginFunc.call(e,b),b.cancel?e.gestureState="prog-cancel-drag":(e.dragMoveFunc&&e.dragMoveFunc.call(e,b),console.log("drag "+a));break;case "begin-input":Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>P&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),e.gestureState="invalid-input",e.viewport.setRenderFlag(!0));break;case "begin-menu":Math.sqrt((b.ox-b.x)**
2+(b.oy-b.y)**2)>P&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),e.gestureState="invalid-menu",e.viewport.setRenderFlag(!0));break;case "begin-hold":Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>P&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),e.gestureState="invalid-hold",e.viewport.setRenderFlag(!0));break;case "begin-swipe":a=f(b);Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>P&&(e.hasOwnProperty("gestureTimerId")&&
(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),!b.swiping&&(("up"==a||"down"==a)&&e.actionFlags&vp.GAF_SWIPEABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&vp.GAF_SWIPEABLE_LEFTRIGHT)&&(e.gestureState="swipe",b.swiping=!0,e.viewport.setRenderFlag(!0),d(b,e),delete b.cancel,e.swipeBeginFunc&&e.swipeBeginFunc.call(e,b),b.cancel?e.gestureState="prog-cancel-swipe":e.swipeMoveFunc&&e.swipeMoveFunc.call(e,b)));break;case "hold":a=new vp.HitList(b.x,b.y);e.getHits(a,M());0==a.hits.length&&
(e.gestureState="abandon-hold",e.viewport.setRenderFlag(!0),e.holdEndFunc&&e.holdEndFunc.call(e,b));break;case "swipe":e.swipeMoveFunc&&e.swipeMoveFunc.call(e,b);break;case "begin-drag":a=f(b);if(Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>P&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),!b.swiping&&(("up"==a||"down"==a)&&e.actionFlags&vp.GAF_DRAGGABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&vp.GAF_DRAGGABLE_LEFTRIGHT))){e.gestureState="drag";b.swiping=
!0;e.viewport.setRenderFlag(!0);d(b,e);for(const m of b.hitList.hits)if(m.gad!==e&&m.gad.secondTouch==g)switch(m.gad.gestureState){case "pinch":m.gad.gestureState="drag",delete m.gad.secondTouch,m.gad.viewport.setRenderFlag(!0),m.gad.pinchEndFunc&&m.gad.pinchEndFunc.call(m.gad),m.gad.dragBeginFunc&&m.gad.dragBeginFunc.call(m.gad,t[m.gad.ownedBy])}e.dragBeginFunc&&e.dragBeginFunc.call(e,b);e.dragMoveFunc&&e.dragMoveFunc.call(e,b)}break;case "drag":e.dragMoveFunc&&e.dragMoveFunc.call(e,b);break;case "pinch":e.pinchMoveFunc&&
e.pinchMoveFunc.call(e,t[e.ownedBy],t[e.secondTouch])}else if(e.secondTouch==g)switch(e.gestureState){case "pinch":e.pinchMoveFunc&&e.pinchMoveFunc.call(e,t[e.ownedBy],t[e.secondTouch])}break;case "up":t.hasOwnProperty(g)||(t[g]={gestureState:"",touching:!1,x:0,y:0,px:0,py:0});b=t[g];b.e=a;b.touching=!1;if("mouse"==a.pointerType){if(0==a.button&&(e=0,b.hitList))for(const m of b.hitList.hits)if(h=m.gad,h.ownedBy==g){if(!e)switch(h.gestureState){case "begin-click":case "recover-click":V();h.clickFunc&&
h.clickFunc.call(h,b);e=1;break;case "begin-input":V();da(h);e=1;break;case "hold":h.holdEndFunc&&h.holdEndFunc.call(h,b);break;case "begin-drag":h.hasOwnProperty("gestureTimerId")&&(clearTimeout(h.gestureTimerId),delete h.gestureTimerId);break;case "drag":h.dragMoveFunc&&h.dragMoveFunc.call(h,b),h.dragEndFunc&&h.dragEndFunc.call(h,b)}delete h.gestureState;delete h.ownedBy;h.viewport.setRenderFlag(!0)}if(2==a.button)for(const m of b.hitList.hits)if(e=m.gad,e.ownedBy==g){switch(e.gestureState){case "begin-menu":e.contextMenuFunc&&
e.contextMenuFunc.call(e,b)}delete e.gestureState;delete e.ownedBy;e.viewport.setRenderFlag(!0)}delete b.hitList}else{e=0;for(const m of b.hitList.hits)if(l=m.gad,h=0,l.ownedBy==g){l.hasOwnProperty("gestureTimerId")&&(clearTimeout(l.gestureTimerId),delete l.gestureTimerId);if(!e)switch(l.gestureState){case "begin-tap":V();l.clickFunc&&l.clickFunc.call(l,b);e=1;break;case "begin-input":V();da(l);e=1;break;case "hold":l.holdEndFunc&&l.holdEndFunc.call(l,b);break;case "tap-and-hold":console.log("tap-and-hold release");
break;case "swipe":l.swipeMoveFunc&&l.swipeMoveFunc.call(l,b);l.swipeEndFunc&&l.swipeEndFunc.call(l,b);break;case "drag":l.dragMoveFunc&&l.dragMoveFunc.call(l,b);l.dragEndFunc&&l.dragEndFunc.call(l,b);break;case "pinch":l.gestureState="drag",l.ownedBy=l.secondTouch,delete l.secondTouch,l.viewport.setRenderFlag(!0),l.pinchEndFunc&&l.pinchEndFunc.call(l),l.dragBeginFunc&&l.dragBeginFunc.call(l,t[l.ownedBy]),h=1}h||(delete l.gestureState,delete l.ownedBy,l.viewport.setRenderFlag(!0))}else if(l.secondTouch==
g)switch(l.gestureState){case "pinch":l.gestureState="drag",delete l.secondTouch,l.viewport.setRenderFlag(!0),l.pinchEndFunc&&l.pinchEndFunc.call(l),l.dragBeginFunc&&l.dragBeginFunc.call(l,t[l.ownedBy])}}"touch"==a.pointerType&&delete t[g];delete b.swiping;break;case "wheel":t.hasOwnProperty(g)||(t[g]={gestureState:"",touching:!1,px:a.layerX*C,py:a.layerY*C});b=t[g];b.e=a;b.touching=!0;b.x=a.layerX*C;b.y=a.layerY*C;b.hitList=new vp.HitList(b.x,b.y);v.getHits(b.hitList,M());b.hitList.sortHits();if("wheel"==
a.type){e=0;for(const m of b.hitList.hits)h=m.gad,e||h.ownedBy||(h.actionFlags&vp.GAF_SCROLLABLE_UPDOWN?(b=t[g],b.e=a,b.x=a.layerX*C,b.ox=b.x,b.px=b.x,b.y=a.layerY*C,b.oy=b.y,b.py=b.y,delete b.cancel,h.swipeBeginFunc&&h.swipeBeginFunc.call(h,b),b.cancel||(b.dx=0,b.x=b.x,b.dy=.8*Math.sign(a.wheelDelta)*window.devicePixelRatio,b.y+=b.dy,h.swipeMoveFunc&&h.swipeMoveFunc.call(h,b),h.swipeEndFunc&&h.swipeEndFunc.call(h,b)),e=1):h.actionFlags&vp.GAF_SCROLLABLE_LEFTRIGHT?(b=t[g],b.e=a,b.x=a.layerX*C,b.ox=
b.x,b.px=b.x,b.y=a.layerY*C,b.oy=b.y,b.py=b.y,delete b.cancel,h.swipeBeginFunc&&h.swipeBeginFunc.call(h,b),b.cancel||(b.dx=.8*Math.sign(a.wheelDelta)*window.devicePixelRatio,b.x+=b.dx,b.dy=0,b.y=b.y,h.swipeMoveFunc&&h.swipeMoveFunc.call(h,b),h.swipeEndFunc&&h.swipeEndFunc.call(h,b)),e=1):h.actionFlags&vp.GAF_PINCHABLE&&(b=t[g],b.e=a,b.x=a.layerX*C,b.ox=b.x,b.px=b.x,b.y=a.layerY*C,b.oy=b.y,b.py=b.y,h.actionFlags&vp.GAF_ROTATABLE&&a.altKey&&h.rotateFunc?h.rotateFunc.call(h,b,Math.sign(a.wheelDelta)):
h.actionFlags&vp.GAF_SCALABLE&&h.zoomFunc&&h.zoomFunc.call(h,b,Math.sign(a.wheelDelta)),e=1))}break;case "drag time reached":t.hasOwnProperty(g)||(t[g]={gestureState:"",touching:!0});b=t[g];b.e=a;if(b.hitList)for(const m of b.hitList.hits)a=m.gad,a.ownedBy==g&&("begin-click"==a.gestureState&&a.actionFlags&vp.GAF_HOLDABLE&&(a.gestureState="hold",a.viewport.setRenderFlag(!0),d(b,a),a.holdBeginFunc&&a.holdBeginFunc.call(a,b)),"begin-drag"!=a.gestureState||b.swiping||(a.gestureState="drag",b.swiping=
!0,a.viewport.setRenderFlag(!0),d(b,a),a.dragBeginFunc&&a.dragBeginFunc.call(a,b)),a.hasOwnProperty("gestureTimerId")&&delete a.gestureTimerId);break;case "tap-and-hold time reached":console.log("tap-and-hold time reached");t.hasOwnProperty(g)||(t[g]={gestureState:"",touching:!0});b=t[g];b.e=a;for(const m of b.hitList.hits)if(a=m.gad,a.ownedBy==g){if(Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)<=P)switch(a.gestureState){case "begin-tap":case "begin-menu":case "begin-input":case "begin-swipe":case "begin-drag":case "begin-hold":if(a.actionFlags&
vp.GAF_CONTEXTMENU&&!b.swiping)a.gestureState="menu-hold",a.viewport.setRenderFlag(!0),d(b,a),a.contextMenuFunc&&a.contextMenuFunc.call(a,b);else if(a.actionFlags&vp.GAF_HOLDABLE&&!b.swiping)a.gestureState="hold",console.log("hold"),a.viewport.setRenderFlag(!0),d(b,a),a.holdBeginFunc&&a.holdBeginFunc.call(a,b);else if(a.actionFlags&vp.GAF_DRAGGABLE&&!b.swiping)a.gestureState="drag",b.swiping=!0,a.viewport.setRenderFlag(!0),d(b,a),a.dragBeginFunc&&a.dragBeginFunc.call(a,b);else if(a.actionFlags&vp.GAF_SWIPEABLE&&
!b.swiping){a.gestureState="swipe";b.swiping=!0;a.viewport.setRenderFlag(!0);for(const n of b.hitList.hits)n.gad!==a&&n.gad.ownedBy==g&&delete n.gad.ownedBy;delete b.cancel;a.swipeBeginFunc&&a.swipeBeginFunc.call(a,b);b.cancel&&(a.gestureState="prog-cancel-swipe")}else a.gestureState="invalid-tap-and-hold",a.viewport.setRenderFlag(!0)}a.hasOwnProperty("gestureTimerId")&&delete a.gestureTimerId}}}}function xa(a,c,d,f,b){w=a;aa=c;Z=d;ea=f;fa=b;k=w.getContext("webgl2",{antialias:!0,alpha:!1,desynchronized:!0,
preserveDrawingBuffer:!0});w.addEventListener("webglcontextlost",l=>{console.log("detected gl context lost");Android?.lostWebGL();l.preventDefault()},!1);w.addEventListener("webglcontextrestored",l=>{console.log("detected gl context restored");Android?.resetWebGL();xa(w,aa,Z,ea,fa);ya(v)},!1);var g=k.viewport.bind(k),e;k.viewport=function(l,m,n,q){e=[l,m,n,q];g(l,m,n,q)};var h=k.getParameter.bind(k);k.getParameter=function(l){return l==k.VIEWPORT&&e?e:h(l)}}function ya(a,c){async function d(){if(0==
e)F=new AudioContext,e=1;else if(1==e){await F.audioWorklet.addModule("data:application/javascript;base64,"+btoa("\n            class AudioProcessor extends AudioWorkletProcessor {\n              constructor() {\n                super();\n                this.lastClick = 0;\n                this.wave = 0;\n                this.fx = 0;\n              }\n              process (inputs, outputs, parameters) {\n                const output = outputs[0];\n                output.forEach(channel => {\n                  for (var i = 0; i < channel.length; i++) {\n                    var sfx = 0;\n                    if (parameters['beep'][0] != this.fx) {\n                      this.fx = parameters['beep'][0];\n                      this.wave = 0;\n                    }\n                    switch (this.fx) {\n                      case 1:\n                        if (this.wave >= 200) this.wave = 0;\n                        sfx = this.wave >= 100? -0.1 : 0.1;\n                        break;\n                      case 2:\n                        if (this.wave >= 100) this.wave = 0;\n                        sfx = this.wave >= 50? -0.1 : 0.1;\n                        break;\n                      case 3:\n                        if (this.wave >= 50) this.wave = 0;\n                        sfx = this.wave >= 25? -0.1 : 0.1;\n                        break;\n                    }\n                    this.wave += 1;\n                    var wind = (Math.random() * 2 - 1)\n                      * (0.000 + (parameters['windspeed'][0]));\n                    channel[i] =\n                      wind +\n                      0.5 * (parameters['click'].length > 1 ? parameters['click'][i] : parameters['click'][0]) + sfx;\n                  }\n                });\n                return true;\n              }\n              static get parameterDescriptors() {\n                return [\n                  {\n                    name: \"windspeed\",\n                    automationRate: \"a-rate\",\n                    defaultValue: 0,\n                    minValue: 0,\n                    maxValue: 1,\n                  },\n                  {\n                    name: \"click\",\n                    automationRate: \"a-rate\",\n                    defaultValue: 0,\n                    minValue: 0,\n                    maxValue: 1,\n                  },\n                  {\n                    name: \"beep\",\n                    automationRate: \"k-rate\",\n                    defaultValue: 0,\n                    minValue: 0,\n                    maxValue: 1,\n                  },\n                ];\n              }\n            }\n            registerProcessor('audio-processor', AudioProcessor);\n\t\t\t\t"));
var h=F.createBufferSource();F.createScriptProcessor(2048);h.start();e=2}else 2==e&&(h=new AudioWorkletNode(F,"audio-processor"),h.connect(F.destination),oa=h.parameters.get("click"),O=h.parameters.get("beep"),ka=h.parameters.get("windspeed"),e=3,g=!0)}if(k){var f=k.createShader(k.VERTEX_SHADER);k.shaderSource(f,"\n        attribute vec4 aVertexPosition;\n        uniform vec4 uVertexColor;\n        uniform mat4 uModelViewMatrix;\n        uniform mat4 uProjectionMatrix;\n        varying vec4 v_Color;\n        void main() {\n          gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n          v_Color = uVertexColor;\n        }\n\t");
k.compileShader(f);if(k.getShaderParameter(f,k.COMPILE_STATUS)){var b=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(b,"\n        varying lowp vec4 v_Color;\n        void main() {\n          gl_FragColor = v_Color;\n        }\n\t");k.compileShader(b);if(k.getShaderParameter(b,k.COMPILE_STATUS)&&(B=k.createProgram(),k.attachShader(B,f),k.attachShader(B,b),k.linkProgram(B),k.getProgramParameter(B,k.LINK_STATUS))){la=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,la);k.vertexAttribPointer(k.getAttribLocation(B,
"aVertexPosition"),2,k.FLOAT,!1,0,0);k.enableVertexAttribArray(k.getAttribLocation(B,"aVertexPosition"));f=[];y.unitLine=f.length/2;f.splice(f.length,0,0,0,1,1);E.unitLine=f.length/2-y.unitLine;y.unitSquare=f.length/2;f.splice(f.length,0,1,1,0,1,0,0,1,0);E.unitSquare=f.length/2-y.unitSquare;y.roundTouch=f.length/2;for(b=0;36>b;b++)f.splice(f.length,0,85*Math.sin(b/18*Math.PI),85*Math.cos(b/18*Math.PI));E.roundTouch=f.length/2-y.roundTouch;y.squareTouch=f.length/2;f.splice(f.length,0,84.5,84.5,-84.5,
84.5,-84.5,-84.5,84.5,-84.5);E.squareTouch=f.length/2-y.squareTouch;y.roundMouse=f.length/2;for(b=0;36>b;b++)f.splice(f.length,0,5*Math.sin(b/18*Math.PI),5*Math.cos(b/18*Math.PI));E.roundMouse=f.length/2-y.roundMouse;y.squareMouse=f.length/2;f.splice(f.length,0,4.5,4.5,-4.5,4.5,-4.5,-4.5,4.5,-4.5);E.squareMouse=f.length/2-y.squareMouse;k.bufferData(k.ARRAY_BUFFER,new Float32Array(f),k.STATIC_DRAW);var g=!1,e=0;a&&(v=a);c&&(window.addEventListener("resize",function(h){U()},!1),U(),window.requestAnimationFrame(ua),
w.addEventListener("touchend",function(h){J(h,"touches")},!1),w.addEventListener("pointerdown",function(h){g||d();h.preventDefault();J(h,"down")},!1),w.addEventListener("pointermove",function(h){h.preventDefault();J(h,"move")},!1),w.addEventListener("pointerup",function(h){g||d();h.preventDefault();J(h,"up")},!1),w.addEventListener("contextmenu",function(h){h.preventDefault()},!1),w.addEventListener("wheel",function(h){h.preventDefault();J(h,"wheel")},!1),document.addEventListener("paste",function(h){var l=
S;l&&l.pasteFunc&&l.pasteFunc.call(l,h)}),document.addEventListener("keydown",function(h){var l=S;l&&l.keydownFunc&&l.keydownFunc.call(l,h)}))}}}}var w,aa,Z,ea,fa,k;const y={},E={};var F,oa,O,ka,la,va,C,ha;const A=[];const N=mat4.create();var na=0,B,S,I,pa,qa,ra,sa,ta;class Aa{constructor(a,c){this.x=a;this.y=c;this.hits=[]}sortHits(){for(var a=[];0<this.hits.length;){var c=0,d=this.hits[0].dist,f,b=this.hits[0].gad.z?this.hits[0].gad.z:0,g;for(f=0;f<this.hits.length&&(g=this.hits[f].gad.z?this.hits[f].gad.z:
0,1);f++)if(g>b||g==b&&this.hits[f].dist<d)c=f,d=this.hits[f].dist,b=g;a.push(this.hits[c]);this.hits.splice(c,1)}this.hits=a}containsAny(a){for(var c=0;c<this.hits.length;c++)if(0!=(this.hits[c].gad.actionFlags&a))return!0;return!1}getActionableGads(a){for(var c=[],d=0;d<this.hits.length;d++)0!=(this.hits[d].gad.actionFlags&a)&&c.splice(c.length,0,this.hits[d].gad);return c}click(){for(var a=0;a<this.hits.length;a++)0!=(this.hits[a].gad.actionFlags&vp.GAF_CLICKABLE)&&this.hits[a].gad.click&&this.hits[a].gad.click.call(this.hits[a].gad)}menu(){for(var a=
0;a<this.hits.length;a++)0!=(this.hits[a].gad.actionFlags&vp.GAF_CONTEXTMENU)&&this.hits[a].gad.menu&&this.hits[a].gad.menu.call(this.hits[a].gad)}}class H{constructor(a,c){this.totalWidth=a;this.totalHeight=c;this.remainingY=this.remainingX=0;this.remainingWidth=a;this.remainingHeight=c}hasArea(){return 0<this.remainingWidth&&0<this.remainingHeight}clear(){this.remainingHeight=this.remainingWidth=this.remainingY=this.remainingX=0}}class T{constructor(a){this.name="unnamed";this.parent=a;this.designFit=
void 0;this.sh=this.sw=this.H=this.W=this.h=this.w=this.y=this.x=this.designHeight=this.designWidth=this.designScale=this.designSize=0;this.userMat=mat4.create();mat4.identity(this.userMat);this.userY=this.userX=this.oy=this.ox=0;this.gadgets=[];this.mat=mat4.create();this.childRender=this.needsRender=!0}queueLayout(){-1===A.indexOf(this)&&A.push(this)}insideFit(a,c){this.viewScale=this.w/a<this.h/c?this.w/a:this.h/c}layoutAll(a){this.x=a.remainingX;this.y=a.remainingY;this.w=a.remainingWidth;this.h=
a.remainingHeight;this.W=a.totalWidth;this.H=a.totalHeight;this.viewScale=this.designFit?0==this.h?1:this.designFit[0]/this.designFit[1]>this.w/this.h?0==this.w?1:this.w/this.designFit[0]:0==this.h?1:this.h/this.designFit[1]:this.designSize?0!=this.w&&0!=this.h?Math.sqrt(this.w*this.h/this.designSize):1:this.designScale?this.designScale:this.designWidth?0==this.w?1:this.w/this.designWidth:this.designHeight?0==this.h?1:this.h/this.designHeight:this.parent?this.parent.viewScale:1;0==this.viewScale&&
(console.log("ZERO SCALE",this.name),this.viewScale=1);this.sw=this.w/this.viewScale;this.sh=this.h/this.viewScale;this.rematrix();this.layoutFunc&&(this.layoutFunc.call(this),this.rematrix());this.setRenderFlag(!0)}rematrix(){mat4.copy(this.mat,N);mat4.scale(this.mat,N,[w.width/this.w,w.height/this.h,1]);mat4.multiply(this.mat,this.mat,this.userMat);mat4.translate(this.mat,this.mat,[this.ox,this.oy,0]);mat4.scale(this.mat,this.mat,[this.viewScale,this.viewScale,1]);mat4.translate(this.mat,this.mat,
[-this.userX,-this.userY,0])}getRawMatrix(){return N}relayout(){if(this.w||this.h){var a=new H;a.totalWidth=this.W;a.totalHeight=this.H;a.remainingX=this.x;a.remainingY=this.y;a.remainingWidth=this.w;a.remainingHeight=this.h;this.layoutAll(a)}}getScale(){return this.viewScale}setRenderFlag(a){this.needsRender||(this.needsRender=this.needsender||a,this.childRender=!0,this.parent&&this.parent.setRenderFlag(!1),a&&this.a&&this.a.setRenderFlag(!0),a&&this.b&&this.b.setRenderFlag(!0),a&&this.c&&this.c.setRenderFlag(!0))}renderAll(a=
!0){this.childRender=!1;this.needsRender&&(this.needsRender=!1,0<this.w&&0<this.h&&(this.clip(),a&&(k.clearColor(0,0,0,1),k.clear(k.COLOR_BUFFER_BIT)),this.renderFunc&&this.renderFunc.call(this)))}clip(){k.viewport(this.x,this.H-this.y-this.h,this.w,this.h);k.scissor(this.x,this.H-this.y-this.h,this.w,this.h);k.enable(k.SCISSOR_TEST)}prepMatrix(){vp.projMat&&vp.viewMat&&(mat4.identity(vp.projMat),mat4.translate(vp.projMat,vp.projMat,[-1,1,0]),mat4.scale(vp.projMat,vp.projMat,[2/this.w,-2/this.h,1]),
mat4.identity(vp.viewMat),mat4.scale(vp.viewMat,vp.viewMat,[this.getScale(),this.getScale(),1]),mat4.translate(vp.viewMat,vp.viewMat,[-this.panX,-this.panY,0]))}getHits(a,c){if(!(0>=this.w||0>=this.h||a.x<this.x-c||a.y<this.y-c||a.x>=this.x+this.w+c||a.y>=this.y+this.h+c))for(const d of this.gadgets)d?d.getHits(a,c):console.log("Bad gadget",this)}}class Ba extends T{constructor(a,c,d,f){super(a);this.type=c;this.stateNew=this.state="";this.stateProg=0;this.size=f;this.ratio=d;this.threshold=1;this.ratioMin=
{h:0,v:0};this.ratioMax={h:1,v:1};this.c=this.b=this.a=void 0;this.prevTime=0}layoutAll(a){super.layoutAll(a);var c=new H(a.totalWidth,a.totalHeight),d=new H(a.totalWidth,a.totalHeight),f=new H(a.totalWidth,a.totalHeight);if(a.hasArea()){this.layoutBeginFunc&&this.layoutBeginFunc.call(this);var b=~~(this.size*this.getScale()),g=this.stateNew;if(""==this.stateNew){var e=a.remainingWidth/this.threshold>a.remainingHeight?!0:!1;this.state=this.stateNew="a"==this.type?e?"v":"h":this.type}e=this.ratio;
if("a"==this.type){var h=0,l=Date.now();0!=this.prevTime&&(h=l-this.prevTime);this.prevTime=l;17<h&&(h=17);a.remainingWidth/this.threshold>a.remainingHeight+2&&(this.stateNew="v");a.remainingWidth/this.threshold<a.remainingHeight+2&&(this.stateNew="h");if(this.stateNew!=this.state||0<this.stateProg)this.stateNew!=this.state?(this.stateProg+=.008*h,1<=this.stateProg&&(this.stateProg=1,this.state=this.stateNew,this.setPoint&&this.stateNew in this.setPoint&&(this.ratio=this.setPoint[this.stateNew])),
-1===A.indexOf(this)&&A.push(this)):(this.stateProg-=.008*h,0>this.stateProg&&(this.stateProg=0),0<this.stateProg&&-1===A.indexOf(this)&&A.push(this));h="v"==this.state?"h":"v";this.setPoint&&h in this.setPoint&&(e=this.setPoint[h])}this.layoutFunc&&this.state!=g&&this.layoutFunc.call(this);g=Math.min(Math.max(this.ratio,this.ratioMin[this.state]),this.ratioMax[this.state]);g!=this.ratio&&(this.ratio=g,-1===A.indexOf(this)&&A.push(this));g=1-this.stateProg*(1-e);e=1-this.stateProg*(0+e);"v"==this.state?
(h=~~((a.remainingWidth-b)*this.ratio),c.remainingWidth=h,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX,c.remainingY=a.remainingY,d.remainingWidth=a.remainingWidth-b-h,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX+h+b,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight,f.remainingX=a.remainingX+h,f.remainingY=a.remainingY,f.remainingWidth=b,f.remainingHeight=a.remainingHeight):"h"==this.state&&(h=~~((a.remainingHeight-b)*this.ratio),c.remainingWidth=
~~(a.remainingWidth*g),c.remainingHeight=h,c.remainingX=a.remainingX,c.remainingY=a.remainingY,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-b-h,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth,d.remainingY=a.remainingY+h+b,f.remainingX=a.remainingX,f.remainingY=a.remainingY+h,f.remainingWidth=a.remainingWidth,f.remainingHeight=b)}else c.clear(),d.clear(),f.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d);this.c&&this.c.layoutAll(f);this.layoutEndFunc&&
this.layoutEndFunc.call(this);g=Math.min(Math.max(this.ratio,this.ratioMin[this.state]),this.ratioMax[this.state]);g!=this.ratio&&(this.ratio=g,-1===A.indexOf(this)&&A.push(this))}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll();this.c&&(this.c.needsRender||this.c.childRender)&&this.c.renderAll()}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c);this.c&&this.c.getHits(a,
c)}}class Ca extends T{constructor(a,c,d,f){super(a);this.type=c;this.stateNew=this.state="";this.stateProg=0;this.sizeH=d;this.sizeV=f?f:d;this.prop=!1;this.threshold=.5;this.b=this.a=void 0;this.prevTime=0;this.tallState=this.wideState="";"t l r b tl tr bl br".split(" ").includes(this.type)||console.error("Warning: Invalid 'type' for SliceView.")}layoutAll(a){super.layoutAll(a);var c=new H(a.totalWidth,a.totalHeight),d=new H(a.totalWidth,a.totalHeight);if(a.hasArea()){var f=~~(this.sizeH*(this.prop?
this.w:this.getScale())),b=~~(this.sizeV*(this.prop?this.h:this.getScale())),g=this.stateNew;if(""==this.stateNew){var e=a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)?!0:!1;"tl"==this.type?(this.wideState="l",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"tr"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"bl"==this.type?(this.wideState="l",this.tallState="b",this.stateNew=e?this.wideState:this.tallState):
"br"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):this.stateNew=this.type;this.state=this.stateNew}if(1<this.type.length){e=0;var h=Date.now();0!=this.prevTime&&(e=h-this.prevTime);this.prevTime=h;17<e&&(e=17);a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)+2&&(this.stateNew=this.wideState);a.remainingHeight*this.threshold>a.remainingWidth*(1-this.threshold)+2&&(this.stateNew=this.tallState);if(this.stateNew!=this.state||0<this.stateProg)this.stateNew!=
this.state?(this.stateProg+=.008*e,1<=this.stateProg&&(this.stateProg=1,this.state=this.stateNew),-1===A.indexOf(this)&&A.push(this)):(this.stateProg-=.008*e,0>this.stateProg&&(this.stateProg=0),0<this.stateProg&&-1===A.indexOf(this)&&A.push(this))}this.layoutFunc&&this.state!=g&&0<this.w&&0<this.h&&this.layoutFunc.call(this);e="t"==this.state||"b"==this.state?b/a.remainingWidth:f/a.remainingHeight;g=1-this.stateProg*(1-e);e=1-this.stateProg*(0+e);"l"==this.state?(c.remainingWidth=b,c.remainingHeight=
~~(a.remainingHeight*g),c.remainingX=a.remainingX,d.remainingWidth=a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX+b,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"r"==this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX+a.remainingWidth-b,d.remainingWidth=a.remainingWidth-
b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"t"==this.state?(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-f,d.remainingY=a.remainingY+f,"l"==this.wideState?(c.remainingX=
a.remainingX,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX)):"b"==this.state&&(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY+a.remainingHeight-f,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-f,d.remainingY=a.remainingY,"l"==this.wideState?(c.remainingX=a.remainingX,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=
a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX))}else c.clear(),d.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll()}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class Da extends T{constructor(a,c){super(a);this.type=c;this.indexProg=this.indexNew=this.index=0;this.b=this.a=
void 0;this.pages=[];this.snaps=[];this.prevTime=0;this.keepPageFlag=!1;this.gadgets.push(this.swipeGad=new vp.SwipeGadget(this));switch(this.type){case "h":this.swipeGad.actionFlags=vp.GAF_SWIPEABLE_LEFTRIGHT|vp.GAF_SCROLLABLE_LEFTRIGHT;break;case "v":this.swipeGad.actionFlags=vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN;break;default:this.swipeGad.actionFlags=0}this.layoutFunc=function(){0!=this.pages.length&&(this.minX=0,this.maxX=this.sw*this.pages.length,this.minY=0,this.maxY=this.sh*this.pages.length,
this.swipeGad.layout.call(this.swipeGad))};this.layoutPageFunc=function(){this.sw=this.parent.sw;this.sh=this.parent.sh;this.layoutFunc_&&this.layoutFunc_()};this.toPage=function(d){var f=this.swipeGad;d=Math.min(Math.max(d,0),this.pages.length);d>this.index?f.doSwipe(!0,d):d<this.index&&f.doSwipe(!1,d)}}keepPage(){this.keepPageFlag=!0}getPageIndex(a){for(var c=0;c<this.pages.length;c++)if(this.pages[c]===a)return c;return-1}getPageOffset(a){return"h"==this.type?this.userX-a*this.sw:this.userY-a*
this.sh}layoutAll(a){super.layoutAll(a);if(0!=this.pages.length){var c=new H(a.totalWidth,a.totalHeight),d=new H(a.totalWidth,a.totalHeight);if(a.hasArea()){this.prevTime=Date.now();var f="h"==this.type,b="v"==this.type;this.snaps=[];for(var g=0;g<this.pages.length;g++)this.snaps.push([this.sw*g*(f?1:0),this.sh*g*(b?1:0)]);if(this.viewScale!=this.prevScale||this.keepPageFlag)this.userX=this.index*this.sw,this.prevScale=this.viewScale,this.keepPageFlag=!1;var e=this.index;g=!1;f&&(this.index=Math.min(Math.max(Math.round(this.userX/
this.sw),0),this.pages.length-1));b&&(this.index=Math.min(Math.max(Math.round(this.userY/this.sh),0),this.pages.length-1));this.index!=e&&this.pageChangeFunc&&(g=!0,this.pageChangeFunc.call(this));e=this.pages[this.index];var h=this.userX+(f?-this.index*this.sw:0),l=this.userY+(b?-this.index*this.sh:0),m=void 0;if(f&&this.index*this.sw>this.userX||b&&this.index*this.sh>this.userY){f&&(e.userX=0);b&&(e.userY=0);var n=this.index-1;if(0<=n&&n<this.pages.length){m=this.pages[n];n=this.userX+(f?-this.index*
this.sw+this.sw:0);var q=this.userY+(b?-this.index*this.sh+this.sh:0);f&&(m.userX=f?n*this.viewScale/m.viewScale:0);b&&(m.userY=b?q*this.viewScale/m.viewScale:0)}}else f&&this.index*this.sw<this.userX||b&&this.index*this.sh<this.userY?(f&&(e.userX=f?h*this.viewScale/e.viewScale:0),b&&(e.userY=b?l*this.viewScale/e.viewScale:0),n=this.index+1,0<=n&&n<this.pages.length&&(m=this.pages[n],f&&(m.userX=0),b&&(m.userY=0))):(f&&(e.userX=0),b&&(e.userY=0));this.a=e;e.parent=this;if(this.b=m)m.parent=this;this.a&&
this.a.layoutFunc!==this.layoutPageFunc&&(this.a.layoutFunc&&(this.a.layoutFunc_=this.a.layoutFunc),this.a.layoutFunc=this.layoutPageFunc);this.b&&this.b.layoutFunc!==this.layoutPageFunc&&(this.b.layoutFunc&&(this.b.layoutFunc_=this.b.layoutFunc),this.b.layoutFunc=this.layoutPageFunc);g&&(m.pageBlurFunc&&m.pageBlurFunc(),e.pageFocusFunc&&e.pageFocusFunc());h=Math.round(h*this.viewScale);l=Math.round(l*this.viewScale);c.remainingWidth=Math.min(Math.max(a.remainingWidth-Math.abs(h),0),a.remainingWidth);
c.remainingHeight=Math.min(Math.max(a.remainingHeight-Math.abs(l),0),a.remainingHeight);c.remainingX=Math.min(Math.max(a.remainingX-(0>h?h:0),a.remainingX),a.remainingX+a.remainingWidth);c.remainingY=Math.min(Math.max(a.remainingY-(0>l?l:0),a.remainingY),a.remainingY+a.remainingHeight);m?f?(d.remainingWidth=a.remainingWidth-c.remainingWidth,d.remainingHeight=a.remainingHeight,d.remainingX=a.remainingX,d.remainingY=a.remainingY,c.remainingX==a.remainingX&&(d.remainingX+=c.remainingWidth)):b&&(d.remainingWidth=
a.remainingWidth,d.remainingHeight=a.remainingHeight-c.remainingHeight,d.remainingX=a.remainingX,d.remainingY=a.remainingY,c.remainingY==a.remainingY&&(d.remainingY+=c.remainingHeight)):d.clear()}else c.clear(),d.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll()}getHits(a,c){super.getHits(a,c);this.a&&this.a.getHits(a,
c);this.b&&this.b.getHits(a,c)}}class Ea extends T{constructor(a,c,d,f){super(a);this.type=c;this.stateNew=this.state="";this.stateProg=0;this.sizeH=d;this.sizeV=f?f:d;this.prop=!1;this.threshold=.5;this.b=this.a=void 0;this.prevTime=0;this.tallState=this.wideState=""}layoutAll(a){super.layoutAll(a);var c=new H(a.totalWidth,a.totalHeight),d=new H(a.totalWidth,a.totalHeight);if(a.hasArea()){var f=~~(this.sizeH*(this.prop?this.w:this.getScale())),b=~~(this.sizeV*(this.prop?this.h:this.getScale())),
g=this.stateNew;if(""==this.stateNew){var e=a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)?!0:!1;"tl"==this.type?(this.wideState="l",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"tr"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"bl"==this.type?(this.wideState="l",this.tallState="b",this.stateNew=e?this.wideState:this.tallState):"br"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:
this.tallState):this.stateNew=this.type;this.state=this.stateNew}if(1<this.type.length){e=0;var h=Date.now();0!=this.prevTime&&(e=h-this.prevTime);this.prevTime=h;17<e&&(e=17);a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)+2&&(this.stateNew=this.wideState);a.remainingHeight*this.threshold>a.remainingWidth*(1-this.threshold)+2&&(this.stateNew=this.tallState);if(this.stateNew!=this.state||0<this.stateProg)this.stateNew!=this.state?(this.stateProg+=.008*e,1<=this.stateProg&&(this.stateProg=
1,this.state=this.stateNew),-1===A.indexOf(this)&&A.push(this)):(this.stateProg-=.008*e,0>this.stateProg&&(this.stateProg=0),0<this.stateProg&&-1===A.indexOf(this)&&A.push(this))}this.layoutFunc&&this.state!=g&&0<this.w&&0<this.h&&this.layoutFunc.call(this);e="t"==this.state||"b"==this.state?b/a.remainingWidth:f/a.remainingHeight;g=1-this.stateProg*(1-e);e=1-this.stateProg*(0+e);"l"==this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX,d.remainingWidth=
a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX+b,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"r"==this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX+a.remainingWidth-b,d.remainingWidth=a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=
a.remainingX,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"t"==this.state?(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-f,d.remainingY=a.remainingY+f,"l"==this.wideState?(c.remainingX=a.remainingX,d.remainingX=a.remainingX+a.remainingWidth-
d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX)):"b"==this.state&&(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY+a.remainingHeight-f,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-f,d.remainingY=a.remainingY,"l"==this.wideState?(c.remainingX=a.remainingX,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,
d.remainingX=a.remainingX))}else c.clear(),d.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll()}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class Fa extends T{constructor(a){super(a);this.b=this.a=void 0}layoutAll(a){super.layoutAll(a);this.layoutFunc&&this.layoutFunc.call(this);var c=new H(a.totalWidth,
a.totalHeight),d=new H(a.totalWidth,a.totalHeight);c.remainingX=a.remainingX;c.remainingY=a.remainingY;c.remainingWidth=a.remainingWidth;c.remainingHeight=a.remainingHeight;d.remainingX=a.remainingX;d.remainingY=a.remainingY;d.remainingWidth=a.remainingWidth;d.remainingHeight=a.remainingHeight;this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}setRenderFlag(a){super.setRenderFlag(!0)}renderAll(){super.renderAll();if(this.a&&(this.a.needsRender||this.a.childRender)||this.b&&(this.b.needsRender||
this.b.childRender))this.b.renderAll(),this.a.renderAll(!1)}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class za extends T{constructor(a){super(a);this.gadgets.push(a=new W(this));a.w=1E3;a.h=1E3;a.convexHull=a.computeHull([0,0,0,1E3,1E3,1E3,1E3,0]);a.click=function(){}}}class W{constructor(a){this.viewport=a;this.mat=mat4.create();mat4.identity(this.mat);this.H=this.h=this.w=this.y=this.x=0;this.convexHull=[];this.extendedHulls={};this.boundingBoxes={};this.yo=this.xo=0;
this.enabled=!0;this.selected=!1;this.actionFlags=0}getHits(a,c){if(this.enabled&&0!=this.convexHull.length){var d=this.viewport,f=vec3.create();mat4.getScaling(f,d.userMat);c=c/d.getScale()/f[0];f=""+c;f in this.extendedHulls||(this.computeExtendedHull(c),this.computeBoundingBox(c));c=this.extendedHulls[f];var b=this.boundingBoxes[f],g=1/d.getScale();f=vec3.create();f[0]=a.x-d.x-this.x/g;f[1]=a.y-d.y-this.y/g;var e=mat4.create();mat4.invert(e,d.userMat);vec3.transformMat4(f,f,e);f=(a.x-d.x-d.ox)*
g+d.userX-this.x-this.xo;d=(a.y-d.y-d.oy)*g+d.userY-this.y-this.yo;if(!(f<b.x1||f>=b.x2||d<b.y1||d>=b.y2)){g=c.length;b=!0;for(e=0;e<g;e+=2){var h=c[e+0];var l=c[e+1];h=(c[(e+2)%g]-h)*(d-l)-(c[(e+3)%g]-l)*(f-h);0>h&&(b=!1)}if(b){g=this.convexHull.length;b=!0;for(e=0;e<g;e+=2)c=this.convexHull[e+0],h=this.convexHull[e+1],h=(this.convexHull[(e+2)%g]-c)*(d-h)-(this.convexHull[(e+3)%g]-h)*(f-c),0>h&&(b=!1);c=0;b||(c=this.distToHull(f,d));a.hits.push({gad:this,dist:c})}}}}autoHull(){this.convexHull=this.computeHull([0,
0,this.w,0,this.w,this.h,0,this.h]);this.extendedHulls={};this.boundingBoxes={}}computeHull(a){function c(r,u,z,D,K,L){return(z-r)*(L-u)-(D-u)*(K-r)}function d(r){return r*r}function f(r,u,z,D,K,L){var G=d(z-K)+d(D-L);if(0==G)return d(r-z)+d(u-D);G=Math.max(0,Math.min(1,((r-z)*(K-z)+(u-D)*(L-D))/G));D+=G*(L-D);return d(r-(z+G*(K-z)))+d(u-D)}function b(r,u,z,D,K,L){if(!(2>u.length)){for(var G=0,Q=0,x=0;x<~~(u.length/2);x++){var R=Math.sqrt(f(u[2*x],u[2*x+1],z,D,K,L));R>Q&&(Q=R,G=x)}Q=u[2*G];R=u[2*
G+1];u.splice(2*G,2);for(x=0;x<~~(r.length/2);x++)if(r[2*x]==z&&r[2*x+1]==D&&r[(2*x+2)%r.length]==K&&r[(2*x+3)%r.length]==L||r[2*x]==K&&r[2*x+1]==L&&r[(2*x+2)%r.length]==z&&r[(2*x+3)%r.length]==D){r.splice(2*x+2,0,Q,R);break}G=[];var X=[];for(x=0;x<~~(u.length/2);x++)0>c(z,D,Q,R,u[2*x],u[2*x+1])&&(G[G.length]=u[2*x],G[G.length]=u[2*x+1]),0>c(Q,R,K,L,u[2*x],u[2*x+1])&&(X[X.length]=u[2*x],X[X.length]=u[2*x+1]);b(r,G,z,D,Q,R);b(r,X,Q,R,K,L)}}for(var g=[...a],e=[],h=0,l=0,m=g[0],n=g[0],q=0;q<~~(g.length/
2);q++)g[2*q]<m&&(m=g[2*q],h=q),g[2*q]>n&&(n=g[2*q],l=q);e[e.length]=g[2*h];e[e.length]=g[2*h+1];e[e.length]=g[2*l];e[e.length]=g[2*l+1];g.splice(2*h,2);l<h?g.splice(2*l,2):g.splice(2*l-2,2);m=[];n=[];for(q=0;q<~~(g.length/2);q++)0>c(a[2*h],a[2*h+1],a[2*l],a[2*l+1],g[2*q],g[2*q+1])?(m[m.length]=g[2*q],m[m.length]=g[2*q+1]):(n[n.length]=g[2*q],n[n.length]=g[2*q+1]);b(e,m,a[2*h],a[2*h+1],a[2*l],a[2*l+1]);b(e,n,a[2*l],a[2*l+1],a[2*h],a[2*h+1]);for(a=1;a;)for(q=a=0;q<~~(e.length/2);q++)if(.01>Math.sqrt(f(e[(2*
q+2)%e.length],e[(2*q+3)%e.length],e[2*q],e[2*q+1],e[(2*q+4)%e.length],e[(2*q+5)%e.length]))){e.splice(2*q+2,2);a=1;break}return this.sortHull(e)}sortHull(a){function c(n){for(n=Math.atan2(a[n+1]-b,a[n+0]-f)-Math.atan2(l-b,h-f);n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;return n}for(var d=[],f=0,b=0,g=a.length,e=0;e<g;e+=2)f+=a[e+0],b+=a[e+1];f/=g/2;b/=g/2;for(var h=f+102,l=b+1;0<a.length;){g=0;var m=c(0);for(e=0;e<a.length;e+=2)c(e)<m&&(g=e,m=c(e));d.push(a[g+0]);d.push(a[g+1]);a.splice(g,
2)}return d}computeExtendedHull(a){for(var c=[],d=0,f=this.convexHull.length,b=0;b<f;b+=2){var g=this.convexHull[(b+3)%f]-this.convexHull[b+1],e=-(this.convexHull[(b+2)%f]-this.convexHull[b+0]),h=a/Math.sqrt(g*g+e*e);c[d+0]=this.convexHull[b+0]+g*h;c[d+1]=this.convexHull[b+1]+e*h;d+=2;c[d+0]=this.convexHull[(b+2)%f]+g*h;c[d+1]=this.convexHull[(b+3)%f]+e*h;d+=2}for(b=0;b<f;b+=2){g=this.convexHull[(b+2)%f]-this.convexHull[b+0];e=this.convexHull[(b+3)%f]-this.convexHull[b+1];d=this.convexHull[(b-2+f)%
f]-this.convexHull[b+0];var l=this.convexHull[(b-1+f)%f]-this.convexHull[b+1];h=Math.sqrt(g*g+e*e);l=Math.tan((Math.PI-Math.acos((g*d+e*l)/(h*Math.sqrt(d*d+l*l))))/4)*a;d=2*b;g=c[d+0]-c[d+2];e=c[d+1]-c[d+3];h=Math.sqrt(g*g+e*e);g=g*(h+l)/h;e=e*(h+l)/h;c[d+0]=g+c[d+2];c[d+1]=e+c[d+3];d=(b-2+f)%f*2;g=c[d+2]-c[d+0];e=c[d+3]-c[d+1];h=Math.sqrt(g*g+e*e);g=g*(h+l)/h;e=e*(h+l)/h;c[d+2]=g+c[d+0];c[d+3]=e+c[d+1]}this.extendedHulls[""+a]=c}computeBoundingBox(a){this.boundingBoxes[""+a]={};var c=this.extendedHulls[""+
a];a=this.boundingBoxes[""+a];if(!(2>c.length)){a.x1=c[0];a.x2=c[0];a.y1=c[1];a.y2=c[1];for(var d=2;d<c.length;d+=2)c[d+0]<a.x1&&(a.x1=c[d+0]),c[d+0]>a.x2&&(a.x2=c[d+0]),c[d+1]<a.y1&&(a.y1=c[d+1]),c[d+1]>a.y2&&(a.y2=c[d+1])}}distToHull(a,c){function d(l){return l*l}function f(l,m,n,q,r,u){var z=d(n-r)+d(q-u);if(0==z)return d(l-n)+d(m-q);z=Math.max(0,Math.min(1,((l-n)*(r-n)+(m-q)*(u-q))/z));q+=z*(u-q);return d(l-(n+z*(r-n)))+d(m-q)}for(var b=this.convexHull,g=Math.sqrt(f(a,c,b[0],b[1],b[2],b[3])),
e=2;e<b.length;e+=2){var h=Math.sqrt(f(a,c,b[e+0],b[e+1],b[(e+2)%b.length],b[(e+3)%b.length]));h<g&&(g=h)}return g}}class Ga extends W{constructor(a){super(a);this.dragBeginFunc=function(c){this.tempX=c.ox-this.viewport.x;this.tempY=c.oy-this.viewport.y};this.dragMoveFunc=function(c){var d=this.viewport.parent,f="h"==d.state,b=f?c.y-this.tempY-d.a.y:c.x-this.tempX-d.a.x;d.ratio=Math.max(0,Math.min(1,b/(b+(f?d.y+d.h-(c.y-this.tempY+this.viewport.h):d.x+d.w-(c.x-this.tempX+this.viewport.w)))));d.setPoint||
(d.setPoint={});d.setPoint[d.state]=d.ratio;-1===A.indexOf(this.viewport.parent)&&A.push(this.viewport.parent)};this.dragEndFunc=function(c){delete this.tempX;delete this.tempY}}layout(){var a=this.viewport,c=a.getScale(),d=a.parent.size,f="h"==a.parent.state;var b=f?Math.max(1,a.w)/c:d;a=f?d:Math.max(1,a.h)/c;this.actionFlags=f?vp.GAF_DRAGGABLE_UPDOWN:vp.GAF_DRAGGABLE_LEFTRIGHT;this.convexHull=this.computeHull([0,0,0,a,b,a,b,0]);this.extendedHulls={};this.boundingBoxes={}}}class Ha extends W{getTargetMat(){return this.targetGad?
this.targetGad.mat:this.targetView.userMat}constructor(a){super(a);this.targetView=a;this.targetGad=void 0;this.dragBeginFunc=function(c){var d=this.targetView;this.grab1b=vec3.create();this.grab1b[0]=c.x-d.x;this.grab1b[1]=c.y-d.y;this.viewMat=mat4.create();mat4.copy(this.viewMat,d.userMat);this.grabMat=mat4.create();mat4.copy(this.grabMat,this.getTargetMat());c=mat4.create();mat4.invert(c,this.viewMat);vec3.transformMat4(this.grab1b,this.grab1b,c);this.targetGad&&(c=mat4.create(),mat4.invert(c,
this.grabMat),vec3.transformMat4(this.grab1b,this.grab1b,c))};this.dragMoveFunc=function(c){var d=this.targetView,f=vec3.create();f[0]=c.x-d.x;f[1]=c.y-d.y;c=mat4.create();mat4.invert(c,this.viewMat);vec3.transformMat4(f,f,c);this.targetGad&&(c=mat4.create(),mat4.invert(c,this.grabMat),vec3.transformMat4(f,f,c));c=vec3.create();vec3.subtract(c,f,this.grab1b);this.targetGad&&vec3.scale(c,c,1/d.getScale());mat4.translate(this.getTargetMat(),this.grabMat,c);d.rematrix();d.setRenderFlag(!0)};this.dragEndFunc=
function(c){c=this.targetView;delete this.grab1b;delete this.viewMat;delete this.grabMat;c.setRenderFlag(!0)};this.pinchBeginFunc=function(c,d){var f=this.targetView;this.grab1=vec3.create();this.grab1[0]=c.x-f.x;this.grab1[1]=c.y-f.y;this.grab2=vec3.create();this.grab2[0]=d.x-f.x;this.grab2[1]=d.y-f.y;this.viewMat=mat4.create();mat4.copy(this.viewMat,f.userMat);this.grabMat=mat4.create();mat4.copy(this.grabMat,this.getTargetMat());this.grabC=vec3.create();this.grab1b=vec3.create();vec3.copy(this.grab1b,
this.grab1);this.grab2b=vec3.create();vec3.copy(this.grab2b,this.grab2);this.grabCb=vec3.create();c=mat4.create();mat4.invert(c,this.viewMat);vec3.transformMat4(this.grab1b,this.grab1b,c);vec3.transformMat4(this.grab2b,this.grab2b,c);this.targetGad&&(c=mat4.create(),mat4.copy(c,this.grabMat),vec3.transformMat4(this.grab1b,this.grab1b,c),vec3.transformMat4(this.grab2b,this.grab2b,c));for(c=0;3>c;c++)this.grabC[c]=(this.grab1[c]+this.grab2[c])/2,this.grabCb[c]=(this.grab1b[c]+this.grab2b[c])/2;c=this.grab2[0]-
this.grab1[0];d=this.grab2[1]-this.grab1[1];this.grabA=Math.atan2(d,c);this.grabM=Math.sqrt(c*c+d*d)};this.pinchMoveFunc=function(c,d){var f=this.targetView,b=vec3.create();b[0]=c.x-f.x;b[1]=c.y-f.y;c=vec3.create();c[0]=d.x-f.x;c[1]=d.y-f.y;var g=vec3.create(),e=vec3.create(),h=vec3.create();d=vec3.create();vec3.copy(e,b);vec3.copy(h,c);var l=mat4.create();mat4.invert(l,this.viewMat);vec3.transformMat4(e,e,l);vec3.transformMat4(h,h,l);this.targetGad&&(l=mat4.create(),mat4.copy(l,this.grabMat),vec3.transformMat4(e,
e,l),vec3.transformMat4(h,h,l));for(l=0;3>l;l++)g[l]=(b[l]+c[l])/2,d[l]=(e[l]+h[l])/2;g=c[0]-b[0];c=c[1]-b[1];b=Math.atan2(c,g);c=Math.sqrt(g*g+c*c);g=mat4.create();mat4.copy(g,this.grabMat);this.targetGad?(this.actionFlags&vp.GAF_DRAGGABLE?mat4.translate(g,g,[d[0]/f.getScale(),d[1]/f.getScale(),0]):mat4.translate(g,g,[this.grabCb[0]/f.getScale(),this.grabCb[1]/f.getScale(),0]),this.actionFlags&vp.GAF_SCALABLE&&mat4.scale(g,g,[c/this.grabM,c/this.grabM,1]),this.actionFlags&vp.GAF_ROTATABLE&&mat4.rotate(g,
g,b-this.grabA,[0,0,1]),mat4.translate(g,g,[-this.grabCb[0]/f.getScale(),-this.grabCb[1]/f.getScale(),0])):(this.actionFlags&vp.GAF_DRAGGABLE?mat4.translate(g,g,[d[0],d[1],0]):mat4.translate(g,g,[this.grabCb[0],this.grabCb[1],0]),this.actionFlags&vp.GAF_SCALABLE&&mat4.scale(g,g,[c/this.grabM,c/this.grabM,1]),this.actionFlags&vp.GAF_ROTATABLE&&mat4.rotate(g,g,b-this.grabA,[0,0,1]),mat4.translate(g,g,[-this.grabCb[0],-this.grabCb[1],0]));f.rematrix();f.setRenderFlag(!0);mat4.copy(this.getTargetMat(),
g)};this.pinchEndFunc=function(c,d){delete this.grab1;delete this.grab1b;delete this.grab2;delete this.grab2b;delete this.grabC;delete this.grabCb;delete this.grabA;delete this.grabM;delete this.grabMat};this.zoomFunc=function(c,d){const f=this.targetView,b=this.getTargetMat(),g=vec3.create();this.actionFlags&vp.GAF_DRAGGABLE?(g[0]=c.x-f.x,g[1]=c.y-f.y):mat4.getTranslation(g,b);c=mat4.create();mat4.invert(c,b);vec3.transformMat4(g,g,c);mat4.translate(b,b,[g[0],g[1],0]);mat4.scale(b,b,[Math.exp(d/
10),Math.exp(d/10),1]);mat4.translate(b,b,[-g[0],-g[1],0]);f.rematrix();f.setRenderFlag(!0)};this.rotateFunc=function(c,d){const f=this.targetView,b=this.getTargetMat(),g=vec3.create();this.actionFlags&vp.GAF_DRAGGABLE?(g[0]=c.x-f.x,g[1]=c.y-f.y):mat4.getTranslation(g,b);c=mat4.create();mat4.invert(c,b);vec3.transformMat4(g,g,c);mat4.translate(b,b,[g[0],g[1],0]);mat4.rotate(b,b,-Math.PI/18*d,[0,0,1]);mat4.translate(b,b,[-g[0],-g[1],0]);f.rematrix();f.setRenderFlag(!0)}}getHits(a,c){this.enabled&&
(0==this.convexHull.length?a.hits.push({gad:this,dist:0}):super.getHits(a,c))}layout(){console.log("MatrixGadget::layout()")}}class Ia extends W{constructor(a){super(a);this.actionFlags=vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN;this.followUp=this.flingFar=!1;this.animState="";this.doSwipe=function(c,d){var f=this.viewport,b;void 0!==d&&(b=Math.min(Math.max(d,0),f.snaps.length));this.actionFlags&(vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN)&&(f.tempVX=0,void 0===f.tempVY&&(f.tempVY=0),
f.tempVY=c?Math.min(f.tempVY,-.001):Math.max(f.tempVY,.001),f.userY-=f.tempVY);this.actionFlags&(vp.GAF_SWIPEABLE_LEFTRIGHT|vp.GAF_SCROLLABLE_LEFTRIGHT)&&(void 0===f.tempVX&&(f.tempVX=0),f.tempVX=c?Math.min(f.tempVX,-.001):Math.max(f.tempVX,.001),f.tempVY=0,f.userX-=f.tempVX);this.followUp=!1;f.relayout();f.setRenderFlag(!0);this.swipeEndFunc(void 0,void 0!==d?f.snaps[b]:void 0)};this.swipeBeginFunc=function(c){var d=this.viewport,f=d.getScale();this.actionFlags&(vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN)&&
(this.tempY=(c.oy-d.y-d.oy)/f+d.userY);this.actionFlags&(vp.GAF_SWIPEABLE_LEFTRIGHT|vp.GAF_SCROLLABLE_LEFTRIGHT)&&(this.tempX=(c.ox-d.x-d.ox)/f+d.userX);this.followUp=!1};this.swipeMoveFunc=function(c){var d=this.viewport,f=d.getScale(),b=d.minX,g=Math.max(d.maxX-d.sw,b),e=d.minY,h=Math.max(d.maxY-d.sh,e);this.maxX&&(g=Math.min(g,this.maxX-d.sw));this.maxY&&(h=Math.min(h,this.maxY-d.sh));switch(this.actionFlags&vp.GAF_SWIPEABLE){case vp.GAF_SWIPEABLE_UPDOWN:f=(c.y-d.y-d.oy)/f+d.userY-this.tempY;d.userY=
Math.min(Math.max(d.userY-f,e),h);d.rematrix();this.layout();d.tempVX=0;d.tempVY=c.dy;break;case vp.GAF_SWIPEABLE_LEFTRIGHT:var l=(c.x-d.x-d.ox)/f+d.userX-this.tempX;d.userX=Math.min(Math.max(d.userX-l,b),g);d.rematrix();this.layout();d.tempVX=c.dx;d.tempVY=0;break;case vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SWIPEABLE_LEFTRIGHT:l=(c.x-d.x-d.ox)/f+d.userX-this.tempX,f=(c.y-d.y-d.oy)/f+d.userY-this.tempY,d.userX=Math.min(Math.max(d.userX-l,b),g),d.userY=Math.min(Math.max(d.userY-f,e),h),d.rematrix(),this.layout(),
d.tempVX=c.dx,d.tempVY=c.dy}this.followUp=!1;d.relayout();d.setRenderFlag(!0)};this.swipeEndFunc=function(c,d){function f(h,l){var m=e.getScale(),n=h[0];h=h[1];var q=l[0];l=l[1];var r=Math.sqrt(q*q+l*l);var u=Math.floor(10*r);var z=(10*r-u)/10,D=(u+1)*u/2;0<r&&(n-=q/r*(D/10+z*u)*1E3/30/m,h-=l/r*(D/10+z*u)*1E3/30/m);return[n,h]}function b(h,l,m){h=vec2.fromValues(h[0],h[1]);l=vec2.fromValues(-l[0],-l[1]);vec2.normalize(l,l);h=vec2.dot(h,l);var n="unset",q;if(m)for(q of m){var r=vec2.fromValues(q[0],
q[1]);r=vec2.dot(r,l);r-=h;if(0<=r&&("unset"==n||r<n)){n=r;var u=q}}if("unset"!=n)return u;if(m)for(q of m)if(r=vec2.fromValues(q[0],q[1]),r=vec2.dot(r,l),r=Math.abs(r-h),"unset"==n||r<n)n=r,u=q;return u}function g(h,l){var m="unset",n;if(l)for(n of l)if(l=Math.sqrt((h[0]-n[0])**2+(h[1]-n[1])**2),"unset"==m||l<m){m=l;var q=n}return q}var e=this.viewport;.001>Math.abs(e.tempVX)&&this.actionFlags&vp.GAF_SWIPEABLE_LEFTRIGHT&&(e.tempVX=.001);.001>Math.abs(e.tempVY)&&this.actionFlags&vp.GAF_SWIPEABLE_UPDOWN&&
(e.tempVY=.001);delete this.tempX;delete this.tempY;this.targetRest=void 0;this.inflect=!1;this.animState="decel";e.snaps&&0<e.snaps.length&&(c=this.flingFar?f([e.userX,e.userY],[e.tempVX,e.tempVY]):b([e.userX,e.userY],[e.tempVX,e.tempVY],e.snaps),c=g(c,e.snaps),this.targetRest=d?d:c,c[0]<e.userX&&0<e.tempVX&&(this.animState="accel"),c[0]>e.userX&&0>e.tempVX&&(this.animState="accel"),c[1]<e.userY&&0<e.tempVY&&(this.animState="accel"),c[1]>e.userY&&0>e.tempVY&&(this.animState="accel"));e.origVX=e.tempVX;
e.newX=e.userX;e.origVY=e.tempVY;e.newY=e.userY;e.magOrig=Math.sqrt(e.tempVX*e.tempVX+e.tempVY*e.tempVY);e.magCur=e.magOrig;this.followUp=!0;this.viewport.queueLayout()};this.followUpFunc=function(){if(this.followUp){var c=this.viewport;switch(this.animState){case "decel":this.coast(!1)&&(this.animState="done");break;case "accel":this.coast(!0)&&(this.animState="done");break;default:this.followUp=!1}c.queueLayout()}};this.coast=function(c){var d=this.viewport,f=d.getScale(),b=d.minX,g=Math.max(d.maxX-
d.sw,b),e=d.minY,h=Math.max(d.maxY-d.sh,e);this.maxX&&(g=Math.min(g,this.maxX-d.sw));this.maxY&&(h=Math.min(h,this.maxY-d.sh));var l=d.newX-1E3*d.tempVX/30/f;f=d.newY-1E3*d.tempVY/30/f;if(this.targetRest&&(c||this.inflect)&&(Math.sign(l-this.targetRest[0])!=Math.sign(d.newX-this.targetRest[0])||Math.sign(f-this.targetRest[1])!=Math.sign(d.newY-this.targetRest[1])))return delete d.newX,delete d.newY,delete d.tempVX,delete d.tempVY,delete d.origVX,delete d.origVY,delete d.magOrig,delete d.magCur,this.actionFlags&
(vp.GAF_SWIPEABLE_LEFTRIGHT|vp.GAF_SCROLLABLE_LEFTRIGHT)&&(d.userX=this.targetRest[0]),this.actionFlags&(vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN)&&(d.userY=this.targetRest[1]),!0;d.newX=l;d.newY=f;this.actionFlags&(vp.GAF_SWIPEABLE_LEFTRIGHT|vp.GAF_SCROLLABLE_LEFTRIGHT)&&(d.userX=Math.min(Math.max(l,b),g));this.actionFlags&(vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN)&&(d.userY=Math.min(Math.max(f,e),h));c=c?d.magCur+.1:d.magCur-.1;if("decel"==this.animState&&Math.sign(c)!=Math.sign(d.magCur))if(this.targetRest)this.inflect=
!0;else return delete d.newX,delete d.newY,delete d.tempVX,delete d.tempVY,delete d.origVX,delete d.origVY,delete d.magOrig,delete d.magCur,!0;d.magCur=c;d.tempVX=d.origVX/d.magOrig*d.magCur;d.tempVY=d.origVY/d.magOrig*d.magCur;return!1}}layout(){var a=this.viewport;0>=a.maxX-a.minX||0>=a.maxY-a.minY||0>=a.sw||0>=a.sh||(this.convexHull=this.computeHull([Math.min(a.minX,0),Math.min(a.minY,0),Math.min(a.minX,0),Math.max(a.maxY,a.sh),Math.max(a.maxX,a.sw),Math.max(a.maxY,a.sh),Math.max(a.maxX,a.sw),
Math.min(a.minY,0)]),this.extendedHulls={},this.boundingBoxes={},this.actionFlags&(vp.GAF_SWIPEABLE_LEFTRIGHT|vp.GAF_SCROLLABLE_LEFTRIGHT)&&(a.userX=Math.min(Math.max(a.userX,a.minX),Math.max(a.maxX-a.sw,a.minX))),this.actionFlags&(vp.GAF_SWIPEABLE_UPDOWN|vp.GAF_SCROLLABLE_UPDOWN)&&(a.userY=Math.min(Math.max(a.userY,a.minY),Math.max(a.maxY-a.sh,a.minY))),this.followUp&&this.followUpFunc&&this.followUpFunc.call(this))}}let V=()=>{},Y=[];var v=new za;var ba=-1,ma=0,ja=0,ia=0,wa=0,t={};const P=15*window.devicePixelRatio;
return{initialize:xa,start:ya,pushRoot:function(a){Y.push(v);v=a;v.queueLayout();U()},peekRoot:function(){return Y[Y.length-1]},popRoot:function(){v=Y.pop();v.queueLayout();U()},getRoot:function(){return v},setRoot:function(a){Y=[];v=a;v.queueLayout();U()},setDebugFlags:function(a,c){wa=!!a;ja=!!c},setKeystrokeSound:function(a){V=a},getContext:function(){return k},getPointerRadius:M,isMouseEnabled:function(){return na},getInputGad:function(){return S},beginInput:da,endInput:ca,setImage:function(a){if(!I){var c=
k.createShader(k.VERTEX_SHADER),d=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(c,"attribute vec2 aVertex;attribute vec2 aUV;varying vec2 vTex;uniform mat4 pm;uniform mat4 mm;uniform vec2 pos;void main(void) {  gl_Position = pm * mm * vec4(aVertex + pos, 0.0, 1.0);  vTex = aUV;}");k.shaderSource(d,"precision highp float;varying vec2 vTex;uniform sampler2D sampler0;void main(void){  gl_FragColor = texture2D(sampler0, vTex);}");k.compileShader(c);k.compileShader(d);I=k.createProgram();k.attachShader(I,
c);k.attachShader(I,d);k.linkProgram(I);k.useProgram(I);sa=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,sa);k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,0]),k.STATIC_DRAW);ta=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,ta);k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),k.STATIC_DRAW);qa=k.getAttribLocation(I,"aVertex");ra=k.getAttribLocation(I,"aUV");k.getUniformLocation(I,"pos")}pa=k.createTexture();k.bindTexture(k.TEXTURE_2D,pa);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,
k.LINEAR);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,a);return pa},drawImage:function(a,c,d){k.useProgram(I);k.enableVertexAttribArray(qa);k.bindBuffer(k.ARRAY_BUFFER,sa);k.vertexAttribPointer(qa,2,k.FLOAT,!1,0,0);k.enableVertexAttribArray(ra);k.bindBuffer(k.ARRAY_BUFFER,ta);k.bindTexture(k.TEXTURE_2D,
a);k.vertexAttribPointer(ra,2,k.FLOAT,!1,0,0);k.uniformMatrix4fv(k.getUniformLocation(I,"pm"),!1,c);k.uniformMatrix4fv(k.getUniformLocation(I,"mm"),!1,d);k.drawArrays(k.TRIANGLE_FAN,0,4)},beep:function(a=""){if(O)switch(a){case "qr-scan":O.setValueAtTime(2,F.currentTime);O.setValueAtTime(3,F.currentTime+.05);O.setValueAtTime(0,F.currentTime+.1);break;case "qr-part":O.setValueAtTime(2,F.currentTime);O.setValueAtTime(0,F.currentTime+.05);break;case "click":oa.setValueAtTime(.1,F.currentTime);oa.setValueAtTime(0,
F.currentTime+.001);break;default:O.setValueAtTime(1,F.currentTime),O.setValueAtTime(0,F.currentTime+.1)}},backAction:function(){var a=new vp.HitList(v.w/2,v.h/2);v.getHits(a,Math.sqrt((v.w/2)**2+(v.h/2)**2));a.sortHits();for(const c of a.hits)a=c.gad,!a.ownedBy&&a.actionFlags&vp.GAF_BACKNAV&&a.clickFunc&&a.clickFunc.call(a,void 0)},View:T,DividerView:Ba,SliceView:Ca,PagesView:Da,PopupView:Ea,ViewOverlay:Fa,ViewPicker:za,Gadget:W,MatrixGadget:Ha,SwipeGadget:Ia,MiddleDividerGadget:Ga,GAF_CLICKABLE:1,
GAF_HOLDABLE:2,GAF_CONTEXTMENU:4,GAF_STRETCHABLE:8,GAF_DRAGGABLE_UPDOWN:16,GAF_DRAGGABLE_LEFTRIGHT:32,GAF_DRAGGABLE:48,GAF_SWIPEABLE_UPDOWN:64,GAF_SWIPEABLE_LEFTRIGHT:128,GAF_SWIPEABLE:192,GAF_SCROLLABLE_UPDOWN:256,GAF_SCROLLABLE_LEFTRIGHT:512,GAF_SCROLLABLE:768,GAF_SCALABLE:1024,GAF_ROTATABLE:2048,GAF_PINCHABLE:3072,GAF_NUMINPUT:4096,GAF_TEXTINPUT:8192,GAF_GONEXT:16384,GAF_BACKNAV:32768,GAF_ALL:3901,HitList:Aa,LayoutState:H}}();
