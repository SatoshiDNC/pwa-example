var compareData,df=function(){function N(f,m,g){m=f.createShader(m);f.shaderSource(m,g);f.compileShader(m);return f.getShaderParameter(m,f.COMPILE_STATUS)?m:(alert("An error occurred compiling the shaders: "+f.getShaderInfoLog(m)),f.deleteShader(m),null)}var e=void 0,w=void 0,k=function(){const f=[[]];f[0][1]=0;f[1]=[];f[1][1]=1;f[2]=[];f[2][1]=2;f[3]=[];f[3][1]=3;f[4]=[];f[4][1]=4;f[5]=[];f[5][1]=5;f[0][2]=6;f[1][2]=7;f[2][2]=8;f[3][2]=9;f[0][3]=10;f[1][3]=11;class m{makeInt(h,c){0>h&&(h=2**(4*c)+
h);return(Array(c+1).join("0")+h.toString(16)).substr(-c)}makeAttr(h,c,b,a){return h.toString(16)+this.makeInt(2+b,2)+this.makeInt(c,1)+this.makeInt(b,1)+this.makeInt(a,b)}makeAttrs(h,c,b,a){for(var l=~~(253/b),r=a.length,q=0,u="";0<r;){var B=r>l?l:r;r-=B;u+=h.toString(16)+this.makeInt(2+b*B,2)+this.makeInt(c,1)+this.makeInt(b,1);for(var y=0;y<B;y++)u+=this.makeInt(a[q],b),q++}return u}makeColorAttrs(h){for(var c=0,b=0,a="",l="";b<h.length;){var r=Math.min(Math.max(0,h[b].length),15);254<c+1+3*r&&
(a+=(4).toString(16)+this.makeInt(1+l.length,2)+this.makeInt(0,1)+l,l="",c=0);c+=1+3*r;l+=r.toString(16);for(var q=0;q<r;q++){var u=h[b][q];u=[(u/16777216&255)/255,(u/65536&255)/255,(u/256&255)/255,(u/1&255)/255];l+=Math.min(Math.max(0,~~(15*u[0])),15).toString(16)+Math.min(Math.max(0,~~(15*u[1])),15).toString(16)+Math.min(Math.max(0,~~(15*u[2])),15).toString(16)}b++}0<l.length&&(a+=(4).toString(16)+this.makeInt(1+l.length,2)+this.makeInt(0,1)+l);return a}makeGlyphSet(h,c,b){return(b?df.ff.CHUNK_COLORGLYPHSET:
df.ff.CHUNK_GLYPHSET).toString(16)+"0c"+this.makeInt(h,6)+this.makeInt(c,6)}makeGlyphAttr(h,c,b){return this.makeAttr(df.ff.CHUNK_GLYPHATTR,h,c,b)}makeGlyphAttrs(h,c,b){return this.makeAttrs(df.ff.CHUNK_GLYPHATTR,h,c,b)}makeEOF(){return df.ff.CHUNK_EOF.toString(16)+"00"}}class g{constructor(h){this.reset(h)}reset(h){this.data=h;this.i=0}skip(h){this.i+=h}getInt(h){var c=h+this.i<=this.data.length?parseInt(this.data.substr(this.i,h),16):parseInt((this.data+Array(this.i+h+1).join("0")).substr(this.i,
h),16);this.i+=h;return c}getChunkHeader(){var h=this.getInt(1),c=this.getInt(2);return{type:h,length:c}}getGlyphSet(){var h=this.getInt(6),c=this.getInt(6);return{first:h,last:c}}getAttrs(h){for(var c=this.getInt(1),b=this.getInt(1),a=[],l=0;l<(h-1-1)/b;l++)a[a.length]=this.getInt(b);return{attr:c,size:b,values:a}}getColorAttrs(h){var c=this.getInt(1),b=[];for(--h;0<h;){var a=this.getInt(1);--h;for(var l,r,q,u=[],B=0;B<a;B++){0<h&&(l=this.getInt(1));--h;0<h&&(r=this.getInt(1));--h;0<h&&(q=this.getInt(1));
--h;var y=[l/15,r/15,q/15,1];u[u.length]=16777216*~~(255*y[0])+65536*~~(255*y[1])+256*~~(255*y[2])+~~(255*y[3])}b[b.length]=u}return{attr:c,values:b}}applySign(h,c){for(var b=0;b<h.length;b++)h[b]>=2**(4*c-1)&&(h[b]-=2**(4*c))}}return{CHUNK_EOF:0,CHUNK_GLYPHSET:1,CHUNK_GLYPHATTR:2,CHUNK_COLORGLYPHSET:3,CHUNK_COLORGLYPHATTR:4,ZD_ENCODE:f,ZD_DECODE:[[0,1],[1,1],[2,1],[3,1],[4,1],[5,1],[0,2],[1,2],[2,2],[3,2],[0,3],[1,3]],ATTR_GLYPH_WIDTH:0,ATTR_GLYPH_HEIGHT:1,ATTR_GLYPH_X1:2,ATTR_GLYPH_Y1:3,ATTR_GLYPH_X2:4,
ATTR_GLYPH_Y2:5,ATTR_GLYPH_IMGX:6,ATTR_GLYPH_IMGY:7,ATTR_GLYPH_IMGZD:8,ATTR_COLORGLYPH_COLORS:0,Packer:m,Parser:g}}();class O{constructor(){this.nextId=1;this.fidelity=4}loadFromURL(f,m,g){var h=new Image;h.associatedGlyphSet=this;h.associatedCallback=m;h.associatedName=f;h.onload=this.imgCallback;h.src=g}loadFromImage(f,m,g){this.loadFromObject(f,m,g)}loadFromCanvas(f,m,g){this.loadFromObject(f,m,g)}initGlyphs(){this.glyphCodes=[];this.glyphWidths=[];this.glyphHeights=[];this.glyphX1=[];this.glyphY1=
[];this.glyphX2=[];this.glyphY2=[];this.glyphSourceX=[];this.glyphSourceY=[];this.glyphSourceZD=[];this.glyphHasColors=[];this.glyphColors=[]}isReady(){return this.ready?!0:!1}imgCallback(f){f=f.target;var m=f.associatedGlyphSet;m.loadFromObject.call(m,f.associatedName,f.associatedCallback,f)}loadFromObject(f,m,g){this.ready=!1;this.finalCallback=m;this.name=f;this.initGlyphs();this.pixCoords=[];this.texCoords=[];this.init2(g);0==this.glyphCodes.length&&(this.init1(g),console.log("Loaded "+this.glyphCodes.length+
" glyphs in old format."))}init1(f){function m(p){function t(){for(;n<z.length&&(0==n%4&&0<A||1==n%4&&(1<A||2>C+A)||2==n%4&&3>C+A||3==n%4);)n+=1;var K=z[n]&15;for(n+=1;n<z.length&&(0==n%4&&0<A||1==n%4&&(1<A||2>C+A)||2==n%4&&3>C+A||3==n%4);)n+=1;return K}var n=0,v=5>=p.zd?p.zd:9>=p.zd?p.zd-6:p.zd-10,C=5>=p.zd?1:9>=p.zd?2:3,A=~~(v/2),z=h.getImageData(p.x,p.y+(1==v%2?g.height:0),p.w,p.h).data;t();v=t();var E=16*t()+t();0==E&&(E=256);var F=16*t()+t();0==F&&(F=256);for(var L=4096*t()+256*t()+16*t()+t(),
M=4096*t()+256*t()+16*t()+t(),G="";n<z.length;)G+=t().toString(16);p.x=L;p.y=M;p.w=E;p.h=F;p.zd=v;return G}var g=f;f=document.createElement("canvas");f.width=g.width;f.height=2*g.height;var h=f.getContext("2d");h.drawImage(g,0,0);h.drawImage(g,0,g.height);for(var c=h.getImageData(0,0,g.width,g.height),b=c.data,a=0;a<b.length;a+=4)b[a+0]=(b[a+0]&240)+~~((b[a+0]&240)/16),b[a+1]=(b[a+1]&240)+~~((b[a+1]&240)/16),b[a+2]=(b[a+2]&240)+~~((b[a+2]&240)/16);h.putImageData(c,0,0);c=h.getImageData(0,g.height,
g.width,g.height);b=c.data;for(a=0;a<b.length;a+=4)b[a+0]=(b[a+0]&15)+16*(b[a+0]&15),b[a+1]=(b[a+1]&15)+16*(b[a+1]&15),b[a+2]=(b[a+2]&15)+16*(b[a+2]&15);h.putImageData(c,0,g.height);a=[];a.x=g.width-2;a.y=1;a.w=1;a.h=5;a.zd=10;c=m(a,!0);do c+=m(a);while(a.x);c=new k.Parser(c);b=c.getChunkHeader();for(var l=0,r=0,q=0,u=0,B=0,y=0,H=0,I=0,J=0,x=0;b.type!=k.CHUNK_EOF;){if(b.type==k.CHUNK_COLORATTR&&0==this.colorType.length)for(a=0;a<this.glyphColorIndices.length;a++)for(;this.glyphColorIndices[a]>=this.colorType.length;)this.colorType[this.colorType.length]=
0;if(b.type==k.CHUNK_SOLIDATTR&&0==this.solidRGB.length)for(a=0;a<this.colorType.length;a++)0==this.colorType[a]&&(this.solidRGB[this.solidRGB.length]=0,this.solidMode[this.solidMode.length]=0);switch(b.type){case k.CHUNK_GLYPHSET:case k.CHUNK_COLORGLYPHSET:if(12==b.length){var D=c.getGlyphSet();for(a=D.first;a<=D.last;a++){var d=this.glyphCodes.length;this.glyphCodes[d]=a;this.glyphWidths[d]=8;this.glyphHeights[d]=8;this.glyphX1[d]=0;this.glyphY1[d]=0;this.glyphX2[d]=8;this.glyphY2[d]=0;this.glyphHasColors[d]=
b.type==k.CHUNK_COLORGLYPHSET?1:0;this.glyphColors[d]=[]}}else console.log("chuck length: ",b.length),console.log("error: bad data 1:",c.data.substr(c.i,10)),c.skip(b.length);break;case k.CHUNK_GLYPHATTR:D=c.i;d=c.getAttrs(b.length);if(1==d.values.length)switch((b.type<<16)+d.attr){case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_WIDTH:for(a=0;a<this.glyphCodes.length;a++)this.glyphWidths[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_HEIGHT:for(a=0;a<this.glyphCodes.length;a++)this.glyphHeights[a]=
d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X1:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length;a++)this.glyphX1[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y1:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length;a++)this.glyphY1[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X2:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length;a++)this.glyphX2[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y2:c.applySign(d.values,
d.size);for(a=0;a<this.glyphCodes.length;a++)this.glyphY2[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGX:for(a=0;a<this.glyphCodes.length;a++)this.glyphSourceX[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGY:for(a=0;a<this.glyphCodes.length;a++)this.glyphSourceY[a]=d.values[0];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGZD:for(a=0;a<this.glyphCodes.length;a++)this.glyphSourceZD[a]=d.values[0];break;default:console.log("chuck length: ",b.length),console.log("ignoring unknown attribute: ",
b.type,d.attr),c.skip(b.length)}else switch((b.type<<16)+d.attr){case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_WIDTH:for(a=0;a<d.values.length;a++)this.glyphWidths[l++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_HEIGHT:for(a=0;a<d.values.length;a++)this.glyphHeights[r++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X1:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphX1[q++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y1:c.applySign(d.values,
d.size);for(a=0;a<d.values.length;a++)this.glyphY1[u++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X2:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphX2[B++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y2:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphY2[y++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGX:for(a=0;a<d.values.length;a++)this.glyphSourceX[H++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+
k.ATTR_GLYPH_IMGY:for(a=0;a<d.values.length;a++)this.glyphSourceY[I++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGZD:for(a=0;a<d.values.length;a++)this.glyphSourceZD[J++]=d.values[a];break;default:console.log("ignoring unknown attribute: ",b.type,d.attr),c.skip(b.length)}c.i-D!=b.length&&console.log("error: bad data 2");break;case k.CHUNK_COLORGLYPHATTR:d=c.getColorAttrs(b.length);switch(d.attr){case k.ATTR_COLORGLYPH_COLORS:for(a=0;a<d.values.length;a++){for(;!this.glyphHasColors[x]&&
x<this.glyphCodes.length;)x++;x<this.glyphCodes.length&&(this.glyphColors[x++]=d.values[a])}break;default:console.log("ignoring unknown color attribute: ",b.type,attr),c.skip(b.length-1)}break;default:console.log("ignoring unknown chunk type: ",b),c.skip(b.length)}b=c.getChunkHeader()}for(a=0;a<this.glyphCodes.length;a++)1==this.glyphSourceZD[a]%2&&(this.glyphSourceY[a]+=g.height);a=g.width;c=g.height;for(b=0;b<this.glyphCodes.length;b++)l=b,this.pixCoords[8*l]=0,this.pixCoords[8*l+1]=this.glyphHeights[b],
this.pixCoords[8*l+2]=0,this.pixCoords[8*l+3]=0,this.pixCoords[8*l+4]=this.glyphWidths[b],this.pixCoords[8*l+5]=0,this.pixCoords[8*l+6]=this.glyphWidths[b],this.pixCoords[8*l+7]=this.glyphHeights[b],this.texCoords[8*l]=this.glyphSourceX[l]/a,this.texCoords[8*l+1]=(this.glyphSourceY[l]+this.glyphHeights[b])/(2*c),this.texCoords[8*l+2]=this.glyphSourceX[l]/a,this.texCoords[8*l+3]=this.glyphSourceY[l]/(2*c),this.texCoords[8*l+4]=(this.glyphSourceX[l]+this.glyphWidths[b])/a,this.texCoords[8*l+5]=this.glyphSourceY[l]/
(2*c),this.texCoords[8*l+6]=(this.glyphSourceX[l]+this.glyphWidths[b])/a,this.texCoords[8*l+7]=(this.glyphSourceY[l]+this.glyphHeights[b])/(2*c);c=h.getImageData(0,0,f.width,f.height);b=c.data;for(a=0;a<~~(b.length/2);a+=4)b[a+0]=16*(b[a+0]&15),b[a+1]=16*(b[a+1]&15),b[a+2]=16*(b[a+2]&15),b[a+0]|=~~(b[a+0]/16),b[a+1]|=~~(b[a+1]/16),b[a+2]|=~~(b[a+2]/16);for(a=~~(b.length/2);a<b.length;a+=4)b[a+0]=16*~~(b[a+0]/16),b[a+1]=16*~~(b[a+1]/16),b[a+2]=16*~~(b[a+2]/16),b[a+0]|=~~(b[a+0]/16),b[a+1]|=~~(b[a+
1]/16),b[a+2]|=~~(b[a+2]/16);h.putImageData(c,0,0);this.data=f;f=h=c=b=null;this.ready=!0;this.finalCallback&&this.finalCallback.call(null)}init2(f){function m(p,t=!1){function n(){for(;v<E.length&&(0==v%4&&0<z||1==v%4&&(1<z||2>A+z)||2==v%4&&3>A+z||3==v%4);)v+=1;var K=E[v]&15;for(v+=1;v<E.length&&(0==v%4&&0<z||1==v%4&&(1<z||2>A+z)||2==v%4&&3>A+z||3==v%4);)v+=1;return K}var v=0,C=5>=p.zd?p.zd:9>=p.zd?p.zd-6:p.zd-10,A=5>=p.zd?1:9>=p.zd?2:3,z=~~(C/2),E=h.getImageData(p.x,p.y+(1==C%2?g.height:0),p.w,
p.h).data;t&&(t=""+n().toString(16),t+=n().toString(16),t+=n().toString(16),t+=n().toString(16),p.ver=t);n();t=n();C=16*n()+n();0==C&&(C=256);var F=16*n()+n();0==F&&(F=256);for(var L=4096*n()+256*n()+16*n()+n(),M=4096*n()+256*n()+16*n()+n(),G="";v<E.length;)G+=n().toString(16);p.x=L;p.y=M;p.w=C;p.h=F;p.zd=t;return G}var g=f;f=document.createElement("canvas");f.width=g.width;f.height=2*g.height;var h=f.getContext("2d",{willReadFrequently:!0});h.drawImage(g,0,0);h.drawImage(g,0,g.height);for(var c=
h.getImageData(0,g.height,g.width,g.height),b=c.data,a=0;a<b.length;a+=4)b[a+0]=(b[a+0]&240)+~~((b[a+0]&240)/16),b[a+1]=(b[a+1]&240)+~~((b[a+1]&240)/16),b[a+2]=(b[a+2]&240)+~~((b[a+2]&240)/16);h.putImageData(c,0,g.height);c=h.getImageData(0,0,g.width,g.height);b=c.data;for(a=0;a<b.length;a+=4)b[a+0]=(b[a+0]&15)+16*(b[a+0]&15),b[a+1]=(b[a+1]&15)+16*(b[a+1]&15),b[a+2]=(b[a+2]&15)+16*(b[a+2]&15);h.putImageData(c,0,0);a=[];a.x=g.width-2;a.y=1;a.w=1;a.h=6;a.zd=10;c=m(a,!0);if("fed1"!=a.ver)console.log("Unrecognized file format.");
else{do c+=m(a);while(a.x);c=new k.Parser(c);b=c.getChunkHeader();for(var l=0,r=0,q=0,u=0,B=0,y=0,H=0,I=0,J=0,x=0;b.type!=k.CHUNK_EOF;){if(b.type==k.CHUNK_COLORATTR&&0==this.colorType.length)for(a=0;a<this.glyphColorIndices.length;a++)for(;this.glyphColorIndices[a]>=this.colorType.length;)this.colorType[this.colorType.length]=0;if(b.type==k.CHUNK_SOLIDATTR&&0==this.solidRGB.length)for(a=0;a<this.colorType.length;a++)0==this.colorType[a]&&(this.solidRGB[this.solidRGB.length]=0,this.solidMode[this.solidMode.length]=
0);switch(b.type){case k.CHUNK_GLYPHSET:case k.CHUNK_COLORGLYPHSET:if(12==b.length){var D=c.getGlyphSet();for(a=D.first;a<=D.last;a++){var d=this.glyphCodes.length;this.glyphCodes[d]=a;this.glyphWidths[d]=8;this.glyphHeights[d]=8;this.glyphX1[d]=0;this.glyphY1[d]=0;this.glyphX2[d]=8;this.glyphY2[d]=0;this.glyphHasColors[d]=b.type==k.CHUNK_COLORGLYPHSET?1:0;this.glyphColors[d]=[]}}else{console.log("chuck length: ",b.length);console.log("error: bad data 1:",c.data.substr(c.i,10));return}break;case k.CHUNK_GLYPHATTR:D=
c.i;d=c.getAttrs(b.length);if(1==d.values.length)switch((b.type<<16)+d.attr){case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_WIDTH:for(a=0;a<this.glyphCodes.length&&!(this.glyphWidths[l++]=d.values[0],l>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_HEIGHT:for(a=0;a<this.glyphCodes.length&&!(this.glyphHeights[r++]=d.values[0],r>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X1:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length&&!(this.glyphX1[q++]=
d.values[0],q>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y1:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length&&!(this.glyphY1[u++]=d.values[0],u>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X2:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length&&!(this.glyphX2[B++]=d.values[0],B>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y2:c.applySign(d.values,d.size);for(a=0;a<this.glyphCodes.length&&
!(this.glyphY2[y++]=d.values[0],y>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGX:for(a=0;a<this.glyphCodes.length&&!(this.glyphSourceX[H++]=d.values[0],H>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGY:for(a=0;a<this.glyphCodes.length&&!(this.glyphSourceY[I++]=d.values[0],I>=this.glyphCodes.length);a++);break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGZD:for(a=0;a<this.glyphCodes.length&&!(this.glyphSourceZD[J++]=d.values[0],
J>=this.glyphCodes.length);a++);break;default:console.log("ignoring unknown attribute: ",b.type,d.attr),c.skip(b.length)}else switch((b.type<<16)+d.attr){case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_WIDTH:for(a=0;a<d.values.length;a++)this.glyphWidths[l++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_HEIGHT:for(a=0;a<d.values.length;a++)this.glyphHeights[r++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X1:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphX1[q++]=
d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y1:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphY1[u++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_X2:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphX2[B++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_Y2:c.applySign(d.values,d.size);for(a=0;a<d.values.length;a++)this.glyphY2[y++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGX:for(a=0;a<d.values.length;a++)this.glyphSourceX[H++]=
d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGY:for(a=0;a<d.values.length;a++)this.glyphSourceY[I++]=d.values[a];break;case (k.CHUNK_GLYPHATTR<<16)+k.ATTR_GLYPH_IMGZD:for(a=0;a<d.values.length;a++)this.glyphSourceZD[J++]=d.values[a];break;default:console.log("ignoring unknown attribute: ",b.type,d.attr),c.skip(b.length)}c.i-D!=b.length&&console.log("error: bad data 2");break;case k.CHUNK_COLORGLYPHATTR:d=c.getColorAttrs(b.length);switch(d.attr){case k.ATTR_COLORGLYPH_COLORS:for(a=
0;a<d.values.length;a++){for(;!this.glyphHasColors[x]&&x<this.glyphCodes.length;)this.glyphColors[x++]=null;x<this.glyphCodes.length&&(this.glyphColors[x++]=d.values[a])}for(;!this.glyphHasColors[x]&&x<this.glyphCodes.length;)this.glyphColors[x++]=null;break;default:console.log("ignoring unknown color attribute: ",b.type,attr),c.skip(b.length-1)}break;default:console.log("ignoring unknown chunk type: ",b),c.skip(b.length)}b=c.getChunkHeader()}for(a=0;a<this.glyphCodes.length;a++)1==this.glyphSourceZD[a]%
2&&(this.glyphSourceY[a]+=g.height);a=g.width;c=g.height;this.texWidth=g.width;this.texHeight=g.height;for(b=0;b<this.glyphCodes.length;b++)l=b,this.pixCoords[8*l]=0,this.pixCoords[8*l+1]=this.glyphHeights[b],this.pixCoords[8*l+2]=0,this.pixCoords[8*l+3]=0,this.pixCoords[8*l+4]=this.glyphWidths[b],this.pixCoords[8*l+5]=0,this.pixCoords[8*l+6]=this.glyphWidths[b],this.pixCoords[8*l+7]=this.glyphHeights[b],this.texCoords[8*l]=this.glyphSourceX[l]/a,this.texCoords[8*l+1]=(this.glyphSourceY[l]+this.glyphHeights[b])/
(2*c),this.texCoords[8*l+2]=this.glyphSourceX[l]/a,this.texCoords[8*l+3]=this.glyphSourceY[l]/(2*c),this.texCoords[8*l+4]=(this.glyphSourceX[l]+this.glyphWidths[b])/a,this.texCoords[8*l+5]=this.glyphSourceY[l]/(2*c),this.texCoords[8*l+6]=(this.glyphSourceX[l]+this.glyphWidths[b])/a,this.texCoords[8*l+7]=(this.glyphSourceY[l]+this.glyphHeights[b])/(2*c);c=h.getImageData(0,0,f.width,f.height);b=c.data;for(a=0;a<~~(b.length/2);a+=4)b[a+0]=16*(b[a+0]&15),b[a+1]=16*(b[a+1]&15),b[a+2]=16*(b[a+2]&15),b[a+
0]|=~~(b[a+0]/16),b[a+1]|=~~(b[a+1]/16),b[a+2]|=~~(b[a+2]/16);for(a=~~(b.length/2);a<b.length;a+=4)b[a+0]=16*~~(b[a+0]/16),b[a+1]=16*~~(b[a+1]/16),b[a+2]=16*~~(b[a+2]/16),b[a+0]|=~~(b[a+0]/16),b[a+1]|=~~(b[a+1]/16),b[a+2]|=~~(b[a+2]/16);h.putImageData(c,0,0);this.data=f;f=h=c=b=null;this.ready=!0;this.finalCallback&&this.finalCallback.call(null)}}init(){if(!w){{var f=e;const m=N(f,f.VERTEX_SHADER,"\n    attribute vec2 aVertex;\n    attribute vec2 aUV;\n    varying vec2 vTex;\n    uniform vec2 pos;\n    uniform mat4 uProjectionMatrix;\n    uniform mat4 uModelViewMatrix;\n    void main(void) {\n      gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aVertex + pos, 0.0, 1.0);\n      vTex = aUV;\n    }\n    "),
g=N(f,f.FRAGMENT_SHADER,"\n    precision highp float;\n    varying vec2 vTex;\n    uniform sampler2D sampler0;\n    uniform lowp vec4 color1;\n    uniform lowp vec4 color2;\n    uniform lowp vec4 color3;\n    uniform int layer;\n    uniform int depth;\n    uniform float scaleFactor;\n    uniform int sampleBase;\n    void main(void){\n      float v1=0.0, v2=0.0, v3=0.0;\n      int ss = sampleBase;\n      float tx =1.0/64.0;\n      float ty =1.0/128.0;\n      float o = float(ss-1)/2.0;\n      int i=0, j=0;\n      for(int i=0; i<4; i++) {\n\t\t\t\tif (i>=ss) break;\n        for(int j=0; j<4; j++) {\n\t\t\t\t\tif (j>=ss) break;\n          vec4 c = texture2D(sampler0, vTex+vec2((float(i)-o)/float(ss)*tx/scaleFactor,(float(j)-o)/float(ss)*ty/scaleFactor));//texture(tex, texCoordOut+vec2((i-o)/float(ss)*tx/scaleFactor,(j-o)/float(ss)*ty/scaleFactor));\n          if (layer == 0) {\n            v1 += c.r>=.5 ? 1.0 : 0.0;\n            if (depth >= 2) v2 += c.g>=.5 ? 1.0 : 0.0;\n            if (depth >= 3) v3 += c.b>=.5 ? 1.0 : 0.0;\n          } else if (layer == 1) {\n            v1 += c.g>=.5 ? 1.0 : 0.0;\n            if (depth >= 2) v2 += c.b>=.5 ? 1.0 : 0.0;\n          } else if (layer == 2) {\n            v1 += c.b>=.5 ? 1.0 : 0.0;\n          }\n        }\n      }\n      //vec4 o1 = vec4(color1.rgb * (v1/float(ss*ss)), v1/float(ss*ss));\n      //vec4 o2 = vec4(color2.rgb * (v2/float(ss*ss)), v2/float(ss*ss));\n      //vec4 o3 = vec4(color3.rgb * (v3/float(ss*ss)), v3/float(ss*ss));\n      vec4 o1 = vec4(color1.rgb, v1/float(ss*ss)*color1.a);\n      vec4 o2 = vec4(color2.rgb, v2/float(ss*ss)*color2.a);\n      vec4 o3 = vec4(color3.rgb, v3/float(ss*ss)*color3.a);\n      o1.rgb += o2.rgb * (1.0 - o1.a); o1.a += o2.a * (1.0 - o1.a);\n      o1.rgb += o3.rgb * (1.0 - o1.a); o1.a += o3.a * (1.0 - o1.a);\n      gl_FragColor = o1;\n    }\n    "),
h=f.createProgram();f.attachShader(h,m);f.attachShader(h,g);f.linkProgram(h);f.getProgramParameter(h,f.LINK_STATUS)?w=h:(alert("Unable to initialize the shader program: "+f.getProgramInfoLog(h)),w=null)}}e.useProgram(w);this.tex=e.createTexture();e.bindTexture(e.TEXTURE_2D,this.tex);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.data);this.vertexBuff=e.createBuffer();
e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuff);e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.pixCoords),e.STATIC_DRAW);this.texBuff=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.texBuff);e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texCoords),e.STATIC_DRAW);this.vloc=e.getAttribLocation(w,"aVertex");this.tloc=e.getAttribLocation(w,"aUV");this.scaleFactorLoc=e.getUniformLocation(w,"scaleFactor");this.sampleBaseLoc=e.getUniformLocation(w,"sampleBase");this.layerLoc=e.getUniformLocation(w,
"layer");this.depthLoc=e.getUniformLocation(w,"depth");this.projMatLoc=e.getUniformLocation(w,"uProjectionMatrix");this.viewMatLoc=e.getUniformLocation(w,"uModelViewMatrix");this.color1Loc=e.getUniformLocation(w,"color1");this.color2Loc=e.getUniformLocation(w,"color2");this.color3Loc=e.getUniformLocation(w,"color3")}update(){e.useProgram(w);e.bindTexture(e.TEXTURE_2D,this.tex);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.data)}calcWidth(f){var m=0;for(let h of f){f=h.codePointAt(0);
var g;for(g=0;g<this.glyphCodes.length&&this.glyphCodes[g]!=f;g++);m+=this.glyphX2[g]-this.glyphX1[g]}return m}findGlyph(f){var m=-1;"number"===typeof f&&(m=f);"string"===typeof f&&(m=f.codePointAt(0));for(f=0;f<this.glyphCodes.length&&this.glyphCodes[f]!=m;f++);return f<this.glyphCodes.length?f:-1}beginObj(){this.objData=[];this.objY=this.objX=0;var f=this.nextId;this.nextId+=1;return f}textObj(f,m,g,h){this.objX+=f;this.objY+=m;f=null===g||void 0===g?!1:"function"===typeof g[Symbol.iterator];if(f)for(let q of g)if(f=
q.codePointAt(0),g=this.findGlyph(f),-1==g)console.log("Missing glyph: decimal",f);else{this.objX+=-this.glyphX1[g];this.objY+=-this.glyphHeights[g]+this.glyphY1[g];if(g<this.glyphCodes.length&&(1<this.glyphWidths[g]||1<this.glyphHeights[g])){f=this.objX+0;m=this.objY+this.glyphHeights[g];h=this.objX+this.glyphWidths[g];var c=this.objY+0,b=this.glyphSourceX[g]/this.texWidth,a=(this.glyphSourceY[g]+this.glyphHeights[g])/(2*this.texHeight),l=(this.glyphSourceX[g]+this.glyphWidths[g])/this.texWidth,
r=this.glyphSourceY[g]/(2*this.texHeight);this.objData.splice(this.objData.length,0,f,m);this.objData.splice(this.objData.length,0,b,a);this.objData.splice(this.objData.length,0,f,c);this.objData.splice(this.objData.length,0,b,r);this.objData.splice(this.objData.length,0,h,c);this.objData.splice(this.objData.length,0,l,r);this.objData.splice(this.objData.length,0,h,c);this.objData.splice(this.objData.length,0,l,r);this.objData.splice(this.objData.length,0,h,m);this.objData.splice(this.objData.length,
0,l,a);this.objData.splice(this.objData.length,0,f,m);this.objData.splice(this.objData.length,0,b,a)}this.objX+=this.glyphX2[g];this.objY+=this.glyphHeights[g]-this.glyphY2[g]}}endObj(){var f=this.objData;delete this.objData;delete this.objX;delete this.objY;return f}draw(f,m,g,h,c,b,a=0){function l(q){return[(q/16777216&255)/255,(q/65536&255)/255,(q/256&255)/255,(q/1&255)/255]}function r(q){return null===q||void 0===q?!1:"function"===typeof q[Symbol.iterator]}0==a&&(a=this.fidelity);e.useProgram(w);
e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.BLEND);e.bindTexture(e.TEXTURE_2D,this.tex);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.enableVertexAttribArray(this.vloc);e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuff);e.vertexAttribPointer(this.vloc,2,e.FLOAT,!1,0,0);e.enableVertexAttribArray(this.tloc);e.bindBuffer(e.ARRAY_BUFFER,this.texBuff);e.vertexAttribPointer(this.tloc,2,e.FLOAT,!1,0,0);e.uniformMatrix4fv(this.projMatLoc,
!1,c);mat4.translate(b,b,[f,m,0]);f=vec3.create();mat4.getScaling(f,c);c=vec3.create();mat4.getScaling(c,b);e.uniform1f(this.scaleFactorLoc,c[0]*f[0]*e.drawingBufferWidth);e.uniform1i(this.sampleBaseLoc,a);r(g)||console.log("Draw warning: string is",g);if(r(g))for(let q of g)a=q.codePointAt(0),g=this.findGlyph(a),-1==g?console.log("Missing glyph: decimal",a):(mat4.translate(b,b,[-this.glyphX1[g],-this.glyphHeights[g]+this.glyphY1[g],0]),g>=this.glyphCodes.length||1==this.glyphWidths[g]&&1==this.glyphHeights[g]||
(a=g,e.uniformMatrix4fv(this.viewMatLoc,!1,b),e.uniform1i(this.layerLoc,~~(k.ZD_DECODE[~~this.glyphSourceZD[g]][0]/2)),e.uniform1i(this.depthLoc,~~k.ZD_DECODE[~~this.glyphSourceZD[g]][1]),c=this.glyphHasColors[g]&&this.glyphColors[g]?this.glyphColors[g].length:0,0==c&&e.uniform4fv(this.color1Loc,h),0<c&&e.uniform4fv(this.color1Loc,l(this.glyphColors[g][0])),1<c&&e.uniform4fv(this.color2Loc,l(this.glyphColors[g][1])),2<c&&e.uniform4fv(this.color3Loc,l(this.glyphColors[g][2])),e.drawArrays(e.TRIANGLE_FAN,
4*a,4)),mat4.translate(b,b,[this.glyphX2[g],this.glyphHeights[g]-this.glyphY2[g],0]))}drawBuf(f,m,g,h,c,b,a=0){0==a&&(a=this.fidelity);e.useProgram(w);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.BLEND);e.bindTexture(e.TEXTURE_2D,this.tex);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.bindBuffer(e.ARRAY_BUFFER,f);e.enableVertexAttribArray(this.vloc);e.vertexAttribPointer(this.vloc,2,e.FLOAT,!1,16,0);e.enableVertexAttribArray(this.tloc);
e.vertexAttribPointer(this.tloc,2,e.FLOAT,!1,16,8);e.uniformMatrix4fv(this.viewMatLoc,!1,b);e.uniform1i(this.layerLoc,0);e.uniform1i(this.depthLoc,0);e.uniform4fv(this.color1Loc,h);e.uniformMatrix4fv(this.projMatLoc,!1,c);f=vec3.create();mat4.getScaling(f,c);c=vec3.create();mat4.getScaling(c,b);e.uniform1f(this.scaleFactorLoc,c[0]*f[0]*e.drawingBufferWidth);e.uniform1i(this.sampleBaseLoc,a);e.drawArrays(e.TRIANGLES,m,g)}}return{glSet:function(f){e=f},getProg:function(){return w},GlyphSet:O,ff:k}}();
